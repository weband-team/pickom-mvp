# Tracking Page - Executive Summary

## Ğ§Ñ‚Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ÑÑ?

Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° real-time Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸ `/tracking/[deliveryId]` Ğ´Ğ»Ñ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñ‹ Pickom.

**ĞšÑ‚Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚**: Sender (Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒ) Ğ¸ Receiver (Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°Ñ‚ĞµĞ»ÑŒ) ÑĞ¼Ğ¾Ñ‚Ñ€ÑÑ‚, Ğ³Ğ´Ğµ Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ÑÑ Picker (ĞºÑƒÑ€ÑŒĞµÑ€)

**Ğ§Ñ‚Ğ¾ Ğ²Ğ¸Ğ´ÑÑ‚ Ğ½Ğ° ÑĞºÑ€Ğ°Ğ½Ğµ**:
- ğŸ—ºï¸ Ğ˜Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°Ñ ĞºĞ°Ñ€Ñ‚Ğ° (Leaflet + OpenStreetMap)
- ğŸŸ¢ Ğ—ĞµĞ»ĞµĞ½Ñ‹Ğ¹ Ğ¼Ğ°Ñ€ĞºĞµÑ€ - Ğ¾Ñ‚ĞºÑƒĞ´Ğ° Ğ·Ğ°Ğ±Ğ¸Ñ€Ğ°ÑÑ‚ Ğ¿Ğ¾ÑÑ‹Ğ»ĞºÑƒ
- ğŸ”´ ĞšÑ€Ğ°ÑĞ½Ñ‹Ğ¹ Ğ¼Ğ°Ñ€ĞºĞµÑ€ - ĞºÑƒĞ´Ğ° Ğ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑÑÑ‚
- ğŸ”µ Ğ¡Ğ¸Ğ½Ğ¸Ğ¹ Ğ¼Ğ°Ñ€ĞºĞµÑ€ - Ñ‚ĞµĞºÑƒÑ‰Ğ°Ñ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ ĞºÑƒÑ€ÑŒĞµÑ€Ğ° (Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ÑÑ ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 10 ÑĞµĞº)
- ğŸ›£ï¸ Ğ¡Ğ¸Ğ½ÑÑ Ğ»Ğ¸Ğ½Ğ¸Ñ - Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚ Ğ¾Ñ‚ ĞºÑƒÑ€ÑŒĞµÑ€Ğ° Ğ´Ğ¾ Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸
- ğŸ“Š Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ: Ñ€Ğ°ÑÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ, Ğ²Ñ€ĞµĞ¼Ñ Ğ² Ğ¿ÑƒÑ‚Ğ¸, ÑÑ‚Ğ°Ñ‚ÑƒÑ

---

## Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚ĞµĞº

| ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ | Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ |
|-----------|------------|
| **Frontend ĞºĞ°Ñ€Ñ‚Ñ‹** | Leaflet 1.9.4 + react-leaflet 5.0.0 |
| **Ğ¢Ğ°Ğ¹Ğ»Ñ‹ ĞºĞ°Ñ€Ñ‚** | OpenStreetMap (Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹Ğµ) |
| **ĞœĞ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ** | OSRM API (Open Source Routing Machine) |
| **Ğ“ĞµĞ¾Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ñ** | Capacitor Geolocation (Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ… picker'Ğ¾Ğ²) |
| **Backend** | NestJS + PostgreSQL |
| **Real-time** | Polling (10 ÑĞµĞº), Ğ¿Ğ¾Ğ·Ğ¶Ğµ WebSocket |

---

## ĞšĞ°Ğº ÑÑ‚Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚?

### 1. Sender/Receiver Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ
```
ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ â†’ /tracking/123 â†’ Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ delivery Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ â†’ ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ ĞºĞ°Ñ€Ñ‚Ñƒ
```

### 2. Picker Ğ² Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞµ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸
```
Picker (Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ) â†’ Geolocation GPS â†’ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ ĞºĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ‚Ñ‹ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€ â†’ ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ user.location Ğ² Ğ‘Ğ”
```

### 3. Real-time Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ
```
ĞšĞ°Ğ¶Ğ´Ñ‹Ğµ 10 ÑĞµĞº â†’ Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€ â†’ ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ½Ğ¾Ğ²ÑƒÑ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ picker'Ğ° â†’ ĞŸĞµÑ€ĞµÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚ â†’ ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ ĞºĞ°Ñ€Ñ‚Ñƒ
```

---

## ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ´Ğ»Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

### Backend
```
pickom-server/src/user/user.controller.ts
  â””â”€ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ: PUT /user/:uid/location

pickom-server/src/user/user.service.ts
  â””â”€ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ: updateLocation(uid, location)

pickom-server/src/delivery/delivery.controller.ts
  â””â”€ Ğ£Ğ¶Ğµ ĞµÑÑ‚ÑŒ: GET /delivery/requests/:id
```

### Frontend
```
pickom-client/app/tracking/[deliveryId]/page.tsx
  â””â”€ ĞĞ¾Ğ²Ğ°Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° (Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ´)

pickom-client/app/api/tracking.ts
  â””â”€ API ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ´Ğ»Ñ tracking endpoints

pickom-client/components/LocationPicker.tsx âœ… Ğ£Ğ¶Ğµ ĞµÑÑ‚ÑŒ
pickom-client/components/DualLocationPicker.tsx âœ… Ğ£Ğ¶Ğµ ĞµÑÑ‚ÑŒ
  â””â”€ ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ°Ğº reference
```

### Mobile (Ğ´Ğ»Ñ Picker)
```
pickom-client/app/active-delivery/[id]/page.tsx
  â””â”€ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ: Geolocation tracking (Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ location)
```

---

## Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ² Ğ±Ğ°Ğ·Ğµ

### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° `deliveries`
```json
{
  "fromLocation": {"lat": 53.9006, "lng": 27.5590, "address": "..."},
  "toLocation": {"lat": 53.9100, "lng": 27.5700, "address": "..."},
  "pickerId": 5,
  "status": "picked_up"
}
```

### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° `users` (Ğ´Ğ»Ñ picker'Ğ°)
```json
{
  "id": 5,
  "uid": "firebase-uid-picker",
  "role": "picker",
  "location": {"lat": 53.9050, "lng": 27.5650, "address": "..."}
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
               Ğ¢Ğ•ĞšĞ£Ğ©ĞĞ¯ ĞŸĞĞ—Ğ˜Ğ¦Ğ˜Ğ¯ - Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ÑÑ Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸
}
```

---

## API Calls

### Frontend Ğ´ĞµĞ»Ğ°ĞµÑ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹:

1. **Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° delivery**:
   ```
   GET /delivery/requests/123
   Response: {fromLocation, toLocation, picker, sender, recipient, status}
   ```

2. **ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸ picker'Ğ°** (polling ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 10 ÑĞµĞº):
   ```
   GET /user/picker-firebase-uid
   Response: {location: {lat, lng, address}, name, rating, phone, ...}
   ```

3. **ĞŸĞ¾ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ°** (OSRM):
   ```
   GET https://router.project-osrm.org/route/v1/driving/{lng},{lat};{lng},{lat}?...
   Response: {routes: [{geometry: {coordinates: [...]}, distance, duration}]}
   ```

### Picker (mobile) Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ:

```
PUT /user/picker-firebase-uid/location
Body: {location: {lat: 53.9055, lng: 27.5655}}
```

---

## ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ´ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ (ÑƒĞ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ½Ğ¾)

```typescript
'use client';
import { MapContainer, TileLayer, Marker, Polyline, Popup } from 'react-leaflet';
import L from 'leaflet';

export default function TrackingPage({ params }) {
  const [delivery, setDelivery] = useState(null);
  const [pickerLocation, setPickerLocation] = useState(null);
  const [route, setRoute] = useState(null);

  // 1. Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ delivery Ğ¿Ñ€Ğ¸ Ğ¼Ğ¾Ğ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¸
  useEffect(() => {
    fetch(`/api/delivery/requests/${params.deliveryId}`)
      .then(r => r.json())
      .then(setDelivery);
  }, []);

  // 2. Polling - Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑÑ‚ÑŒ picker location ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 10 ÑĞµĞº
  useEffect(() => {
    if (!delivery?.picker) return;

    const interval = setInterval(async () => {
      const picker = await fetch(`/api/user/${delivery.picker.uid}`).then(r => r.json());
      setPickerLocation(picker.location);

      // ĞŸĞµÑ€ĞµÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚
      const newRoute = await calculateRoute(picker.location, delivery.toLocation);
      setRoute(newRoute);
    }, 10000);

    return () => clearInterval(interval);
  }, [delivery]);

  // 3. Ğ ĞµĞ½Ğ´ĞµÑ€ ĞºĞ°Ñ€Ñ‚Ñ‹
  return (
    <MapContainer center={[delivery.toLocation.lat, delivery.toLocation.lng]} zoom={13}>
      <TileLayer url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png" />

      {/* From marker (green) */}
      <Marker position={[delivery.fromLocation.lat, delivery.fromLocation.lng]} icon={greenIcon} />

      {/* To marker (red) */}
      <Marker position={[delivery.toLocation.lat, delivery.toLocation.lng]} icon={redIcon} />

      {/* Picker marker (blue) */}
      {pickerLocation && (
        <Marker position={[pickerLocation.lat, pickerLocation.lng]} icon={blueIcon}>
          <Popup>
            <div>
              <h3>{delivery.picker.name}</h3>
              <p>Rating: {delivery.picker.rating} â­</p>
              <p>Phone: {delivery.picker.phone}</p>
            </div>
          </Popup>
        </Marker>
      )}

      {/* Route polyline */}
      {route && <Polyline positions={route.coordinates} color="#2563eb" />}
    </MapContainer>
  );
}
```

---

## Ğ’Ñ€ĞµĞ¼Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

| Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° | Ğ’Ñ€ĞµĞ¼Ñ |
|--------|-------|
| Backend endpoint (PUT /user/:uid/location) | 30 Ğ¼Ğ¸Ğ½ |
| Frontend TrackingPage Ğ¾ÑĞ½Ğ¾Ğ²Ğ° | 2 Ñ‡Ğ°ÑĞ° |
| Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ OSRM Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ | 1 Ñ‡Ğ°Ñ |
| Polling Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° | 30 Ğ¼Ğ¸Ğ½ |
| Geolocation Ğ² picker app | 1 Ñ‡Ğ°Ñ |
| Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ° | 1-2 Ñ‡Ğ°ÑĞ° |
| **Ğ˜Ğ¢ĞĞ“Ğ** | **5-7 Ñ‡Ğ°ÑĞ¾Ğ²** |

---

## ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ñ‹

### 1. SSR Issue Ñ Leaflet
**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°**: Leaflet Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ `window` Ğ¾Ğ±ÑŠĞµĞºÑ‚, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ**:
```typescript
const [isMounted, setIsMounted] = useState(false);
useEffect(() => setIsMounted(true), []);
if (!isMounted) return <div>Loading map...</div>;
```

### 2. Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ ĞºĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ‚ OSRM vs Leaflet
**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°**: OSRM Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ `[lng, lat]`, Leaflet Ğ¾Ğ¶Ğ¸Ğ´Ğ°ĞµÑ‚ `[lat, lng]`

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ**:
```typescript
const coordinates = osrmData.geometry.coordinates.map(
  coord => [coord[1], coord[0]] // swap lng/lat â†’ lat/lng
);
```

### 3. Battery drain Ğ¾Ñ‚ Geolocation
**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°**: ĞŸĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ½Ñ‹Ğ¹ GPS tracking ÑÑŠĞµĞ´Ğ°ĞµÑ‚ Ğ±Ğ°Ñ‚Ğ°Ñ€ĞµÑ

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ**:
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `maximumAge` Ğ´Ğ»Ñ ĞºĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
- Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°Ñ‚ÑŒ tracking Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ñ€Ğ¸ ÑÑ‚Ğ°Ñ‚ÑƒÑĞµ `picked_up`
- ĞÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¸ `delivered` Ğ¸Ğ»Ğ¸ `cancelled`

---

## Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ ÑˆĞ°Ğ³Ğ¸

### Ğ”Ğ»Ñ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹:
1. âœ… ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ `TRACKING_PAGE_CONTEXT.md` (Ğ¿Ğ¾Ğ»Ğ½Ğ°Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ)
2. âœ… Ğ˜Ğ·ÑƒÑ‡Ğ¸Ñ‚ÑŒ `TRACKING_PAGE_QUICKSTART.md` (Ğ¿Ğ¾ÑˆĞ°Ğ³Ğ¾Ğ²Ñ‹Ğ¹ Ğ³Ğ°Ğ¹Ğ´)
3. âœ… ĞŸĞ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ `TRACKING_ARCHITECTURE.md` (Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°)

### MVP Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ (Ğ² Ğ¿Ğ¾Ñ€ÑĞ´ĞºĞµ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ğ°):
1. â­ Backend: `PUT /user/:uid/location` endpoint
2. â­ Frontend: Ğ‘Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° `/tracking/[id]` Ñ ĞºĞ°Ñ€Ñ‚Ğ¾Ğ¹
3. â­ Frontend: Polling Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ picker location
4. â­ Frontend: OSRM Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ°
5. ğŸ”„ Mobile: Geolocation tracking Ğ² active-delivery page

### ĞĞ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ (Ğ¿Ğ¾ÑĞ»Ğµ MVP):
6. WebSocket Ğ²Ğ¼ĞµÑÑ‚Ğ¾ polling
7. ĞĞ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¿ĞµÑ€ĞµĞ¼ĞµÑ‰ĞµĞ½Ğ¸Ñ Ğ¼Ğ°Ñ€ĞºĞµÑ€Ğ°
8. Push notifications
9. Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ñ‚Ñ€Ğ°ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ

---

## Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ñ€ĞµÑÑƒÑ€ÑÑ‹

### Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ
- **ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚**: `TRACKING_PAGE_CONTEXT.md` (Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹)
- **Quick Start**: `TRACKING_PAGE_QUICKSTART.md` (Ñ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ğ°Ğ¼Ğ¸ ĞºĞ¾Ğ´Ğ°)
- **ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°**: `TRACKING_ARCHITECTURE.md` (Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹)
- **Ğ­Ñ‚Ğ¾Ñ‚ Ñ„Ğ°Ğ¹Ğ»**: `TRACKING_SUMMARY.md` (ĞºÑ€Ğ°Ñ‚ĞºĞ°Ñ ÑĞ²Ğ¾Ğ´ĞºĞ°)

### Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğµ ÑÑÑ‹Ğ»ĞºĞ¸
- Leaflet: https://leafletjs.com/
- React-Leaflet: https://react-leaflet.js.org/
- OSRM API: https://project-osrm.org/docs/v5.24.0/api/
- Capacitor Geolocation: https://capacitorjs.com/docs/apis/geolocation

### Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹ ĞºĞ¾Ğ´ Ğ² Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğµ
- `pickom-client/components/LocationPicker.tsx` - Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ ĞºĞ°Ñ€Ñ‚Ñ‹ Ñ Ğ¾Ğ´Ğ½Ğ¸Ğ¼ Ğ¼Ğ°Ñ€ĞºĞµÑ€Ğ¾Ğ¼
- `pickom-client/components/DualLocationPicker.tsx` - Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ Ñ Ğ´Ğ²ÑƒĞ¼Ñ Ğ¼Ğ°Ñ€ĞºĞµÑ€Ğ°Ğ¼Ğ¸ + OSRM
- `pickom-client/app/active-delivery/[id]/page.tsx` - ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¹ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸ (picker)

---

## Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pickom - Delivery Tracking                           [X]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                    â”‚   â”‚
â”‚  â”‚         ğŸ—ºï¸ OpenStreetMap                          â”‚   â”‚
â”‚  â”‚                                                    â”‚   â”‚
â”‚  â”‚    ğŸŸ¢ Pickup Point                                â”‚   â”‚
â”‚  â”‚     (fromLocation)                                â”‚   â”‚
â”‚  â”‚                                                    â”‚   â”‚
â”‚  â”‚              ğŸ”µ Picker                            â”‚   â”‚
â”‚  â”‚            (moving marker)                        â”‚   â”‚
â”‚  â”‚                  â”‚                                â”‚   â”‚
â”‚  â”‚                  â”‚ ğŸ›£ï¸ Route                      â”‚   â”‚
â”‚  â”‚                  â”‚ (Blue polyline)               â”‚   â”‚
â”‚  â”‚                  â–¼                                â”‚   â”‚
â”‚  â”‚                                                    â”‚   â”‚
â”‚  â”‚                 ğŸ”´ Delivery Point                 â”‚   â”‚
â”‚  â”‚                  (toLocation)                     â”‚   â”‚
â”‚  â”‚                                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                            â”‚
â”‚  ğŸ“¦ Package: "Important Documents"                        â”‚
â”‚  ğŸ“ Status: Picked Up                                     â”‚
â”‚  ğŸ“ Distance: 12.5 km                                     â”‚
â”‚  â±ï¸ ETA: 25 min                                           â”‚
â”‚                                                            â”‚
â”‚  ğŸš— Picker: John Smith â­ 4.8                             â”‚
â”‚     ğŸ“ +375 29 123 45 67                                  â”‚
â”‚     âœ… 156 completed deliveries                           â”‚
â”‚                                                            â”‚
â”‚  [Open Chat] [Contact Support]                            â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Checklist Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

### Backend
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ `PUT /user/:uid/location` endpoint
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ `updateLocation()` Ğ² UserService
- [ ] ĞŸÑ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ location Ñ‡ĞµÑ€ĞµĞ· Postman

### Frontend - Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ `/app/tracking/[deliveryId]/page.tsx`
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ `'use client'` Ğ¸ SSR handling
- [ ] Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Leaflet ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹
- [ ] ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ñ‚Ñ€Ğ¸ Ğ¼Ğ°Ñ€ĞºĞµÑ€Ğ° (from, to, picker)

### Frontend - Ğ›Ğ¾Ğ³Ğ¸ĞºĞ°
- [ ] Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° delivery Ğ¿Ñ€Ğ¸ mount
- [ ] Polling ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 10 ÑĞµĞº
- [ ] Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ OSRM Ğ´Ğ»Ñ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ°
- [ ] ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº (fallback Ğ½Ğ° Ğ¿Ñ€ÑĞ¼ÑƒÑ Ğ»Ğ¸Ğ½Ğ¸Ñ)

### Frontend - UI
- [ ] Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ğ°Ñ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ (title, status, distance, ETA)
- [ ] Popup Ğ½Ğ° picker marker (name, rating, phone)
- [ ] Loading Ğ¸ error states
- [ ] Responsive Ğ´Ğ¸Ğ·Ğ°Ğ¹Ğ½

### Mobile (Picker App)
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Geolocation tracking Ğ² active-delivery
- [ ] ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸ ÑÑ‚Ğ°Ñ‚ÑƒÑĞµ `picked_up`
- [ ] ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° tracking Ğ¿Ñ€Ğ¸ `delivered`/`cancelled`

### Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
- [ ] Desktop Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€
- [ ] Mobile Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€
- [ ] Android Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ (Capacitor)
- [ ] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ±Ğ°Ñ‚Ğ°Ñ€ĞµĞ¸ Ğ½Ğ° Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ¼

---

**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ**: Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾ Ğº Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ âœ…
**ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚**: Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ (ĞºĞ»ÑÑ‡ĞµĞ²Ğ°Ñ Ñ„Ğ¸Ñ‡Ğ° MVP)
**Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ**: Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ
**Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸**: Ğ’ÑĞµ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ñ‹Ğµ Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸ ÑƒĞ¶Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹
