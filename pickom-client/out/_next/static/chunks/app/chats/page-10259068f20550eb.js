(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[478,6509],{14140:(e,t,a)=>{"use strict";a.d(t,{j:()=>s});var r=a(23915),i=a(45404);let n=(0,r.Wp)({apiKey:"AIzaSyDiclg8XNo2L1hDBoaSoHmFMBggUKYjHH4",authDomain:"pickom-mvp.firebaseapp.com",projectId:"pickom-mvp",storageBucket:"pickom-mvp.firebasestorage.app",messagingSenderId:"168767828055",appId:"1:168767828055:web:2853961b44970c114ab312"}),s=(0,i.xI)(n)},16509:(e,t,a)=>{"use strict";a.d(t,{TJ:()=>o,_z:()=>c,createChat:()=>i,iS:()=>l,m7:()=>s,ug:()=>n});var r=a(51070);let i=async e=>r.xh.post("/chat/create",e),n=async()=>r.xh.get("/chat"),s=async e=>r.xh.get("/chat/delivery/".concat(e)),o=async e=>r.xh.get("/chat/".concat(e)),c=async(e,t)=>r.xh.post("/chat/".concat(e,"/messages"),t),l=async e=>r.xh.patch("/chat/".concat(e,"/messages/mark-read"))},21515:(e,t,a)=>{"use strict";a.d(t,{ChatListItem:()=>o});var r=a(95155),i=a(54581),n=a(42663),s=a(71116);let o=e=>{var t;let{chatSession:a,onClick:o,unread:c=!1}=e,l=a.lastMessage,d=a.pickerName||"Picker";return l?(0,r.jsxs)(i.default,{onClick:o,sx:{display:"flex",alignItems:"center",gap:2,p:2,cursor:"pointer",borderBottom:1,borderColor:"divider","&:hover":{backgroundColor:"action.hover"},"&:active":{backgroundColor:"action.selected"}},children:[(0,r.jsx)(n.default,{sx:{width:48,height:48,fontSize:"1.2rem"},children:d.split(" ").map(e=>e[0]).join("")}),(0,r.jsxs)(i.default,{sx:{flex:1,minWidth:0},children:[(0,r.jsxs)(i.default,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:.5},children:[(0,r.jsx)(s.default,{variant:"body1",sx:{fontWeight:c?600:400,fontSize:"1rem"},children:d}),(0,r.jsx)(s.default,{variant:"caption",sx:{color:"#666666",fontSize:"0.75rem",flexShrink:0,ml:1},children:(e=>{let t=new Date,a="string"==typeof e?new Date(e):e,r=t.getTime()-a.getTime(),i=Math.floor(r/6e4),n=Math.floor(r/36e5),s=Math.floor(r/864e5);return i<60?"".concat(i,"m ago"):n<24?"".concat(n,"h ago"):"".concat(s,"d ago")})(null!=(t=null==l?void 0:l.createdAt)?t:new Date)})]}),(0,r.jsxs)(i.default,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsx)(s.default,{variant:"body2",sx:{color:"#666666",fontSize:"0.875rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontWeight:c?500:400},children:((e,t)=>e.length<=t?e:e.substring(0,t)+"...")(l.content,50)}),(0,r.jsxs)(i.default,{sx:{display:"flex",alignItems:"center",gap:1,flexShrink:0,ml:1},children:[(0,r.jsx)(i.default,{sx:{width:8,height:8,borderRadius:"50%",backgroundColor:(e=>{switch(e){case"active":return"#FFC107";case"price_confirmed":return"#FF9500";case"completed":return"#4CAF50";default:return"#9E9E9E"}})(a.status)}}),c&&(0,r.jsx)(i.default,{sx:{width:8,height:8,borderRadius:"50%",backgroundColor:"primary.main"}})]})]})]})]}):null}},21717:(e,t,a)=>{"use strict";a.d(t,{n:()=>i});var r=a(51070);let i={getUserNotifications:async()=>(await r.xh.get("/notifications")).data,getUnreadCount:async()=>(await r.xh.get("/notifications/unread-count")).data.count,markAsRead:async e=>(await r.xh.patch("/notifications/".concat(e,"/read"))).data,markAllAsRead:async()=>{await r.xh.patch("/notifications/mark-all-read")},notifyOfferReceived:async e=>(await r.xh.post("/notifications/offer-received",e)).data,notifyOfferAccepted:async e=>(await r.xh.post("/notifications/offer-accepted",e)).data,notifyIncomingDelivery:async e=>(await r.xh.post("/notifications/incoming-delivery",e)).data,notifyStatusUpdate:async e=>(await r.xh.post("/notifications/status-update",e)).data,createNotification:async e=>(await r.xh.post("/notifications/create",e)).data}},27604:(e,t,a)=>{"use strict";a.d(t,{K:()=>s});var r=a(12115),i=a(21717),n=a(16509);function s(){let[e,t]=(0,r.useState)(0),[a,s]=(0,r.useState)(0),[o,c]=(0,r.useState)(0),[l,d]=(0,r.useState)(!0),u=(0,r.useCallback)(async()=>{try{let[e,a]=await Promise.all([(0,n.ug)().catch(()=>({data:[]})),i.n.getUnreadCount().catch(()=>0)]),r=e.data.reduce((e,t)=>e+(t.unreadCount||0),0);t(r),s(a),c(0)}catch(e){console.error("Failed to fetch navigation badge counts:",e)}finally{d(!1)}},[]);return(0,r.useEffect)(()=>{u()},[u]),(0,r.useEffect)(()=>{let e=setInterval(u,3e4);return()=>clearInterval(e)},[u]),(0,r.useEffect)(()=>{let e=()=>{u()};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[u]),{unreadChats:e,unreadNotifications:a,activeOrders:o,isLoading:l,refresh:u}}},37776:(e,t,a)=>{Promise.resolve().then(a.bind(a,90621))},51070:(e,t,a)=>{"use strict";a.d(t,{Bb:()=>o,H$:()=>n,xh:()=>s,y3:()=>c});var r=a(23464),i=a(14140);let n=a(6267).Ii.isNativePlatform()?"http://10.0.2.2:4242":"http://localhost:4242",s=r.A.create({baseURL:n,withCredentials:!0,timeout:3e4,headers:{"Content-Type":"application/json"}});s.interceptors.request.use(async e=>{let t=i.j.currentUser;if(t)try{let a=await t.getIdToken();e.headers.Authorization="Bearer ".concat(a)}catch(e){}return e},e=>Promise.reject(e)),s.interceptors.response.use(e=>e,e=>Promise.reject(e));let o=r.A.create({baseURL:n,withCredentials:!0,timeout:3e4,headers:{"Content-Type":"application/json"}});async function c(){try{return await r.A.get("".concat(n,"/api"),{timeout:5e3}),!0}catch(e){return!1}}o.interceptors.response.use(e=>e,e=>Promise.reject(e))},90621:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m});var r=a(95155),i=a(54581),n=a(14426),s=a(92302),o=a(71116),c=a(68534),l=a(35695),d=a(43452),u=a(58343),h=a(21515),f=a(97704),x=a(27604),p=a(16509),g=a(12115);function m(){let e=(0,l.useRouter)(),{unreadChats:t,unreadNotifications:a,activeOrders:m}=(0,x.K)(),[b,v]=(0,g.useState)([]),[y,j]=(0,g.useState)(!0),[C,w]=(0,g.useState)("");(0,g.useEffect)(()=>{(async()=>{try{let e=await (0,p.ug)();v(e.data)}catch(e){w("Failed to load chats. Please try again.")}finally{j(!1)}})()},[]);let k=(0,g.useMemo)(()=>[...b].sort((e,t)=>{let a=new Date(e.updatedAt).getTime();return new Date(t.updatedAt).getTime()-a}),[b]),S=(0,g.useMemo)(()=>b.reduce((e,t)=>e+(t.unreadCount||0),0),[b]);return y?(0,r.jsx)(i.default,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.default",p:2},children:(0,r.jsx)(n.default,{})}):C?(0,r.jsx)(i.default,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.default",p:2},children:(0,r.jsx)(s.A,{severity:"error",children:C})}):0===k.length?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.MobileContainer,{showFrame:!1,children:(0,r.jsxs)(i.default,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",p:3,pb:10},children:[(0,r.jsxs)(i.default,{sx:{mb:3},children:[(0,r.jsx)(o.default,{sx:{fontSize:"4rem",textAlign:"center",mb:2},children:"\uD83D\uDCAC"}),(0,r.jsx)(u.Lm,{variant:"full",sx:{fontSize:"1.5rem"}})]}),(0,r.jsx)(o.default,{variant:"h5",sx:{textAlign:"center",mb:2,fontWeight:600,color:"text.primary"},children:"No conversations yet"}),(0,r.jsx)(o.default,{variant:"body1",sx:{textAlign:"center",color:"text.secondary",mb:4,maxWidth:320,lineHeight:1.6},children:"Start your first delivery to connect with reliable pickers and begin chatting in real-time"}),(0,r.jsx)(c.A,{variant:"contained",onClick:()=>{e.push("/delivery-methods")},size:"large",sx:{textTransform:"none",fontSize:"1rem",fontWeight:600,px:5,py:1.75,borderRadius:3,boxShadow:"0 4px 12px rgba(255, 149, 0, 0.3)","&:hover":{boxShadow:"0 6px 16px rgba(255, 149, 0, 0.4)"}},children:"\uD83D\uDE80 Start a Delivery"})]})}),(0,r.jsx)(f.default,{unreadChatsCount:t,unreadNotificationsCount:a,activeOrdersCount:m})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.MobileContainer,{showFrame:!1,children:(0,r.jsxs)(i.default,{sx:{display:"flex",flexDirection:"column",height:"100vh"},children:[(0,r.jsxs)(i.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:2,borderBottom:1,borderColor:"divider"},children:[(0,r.jsx)(o.default,{variant:"h5",sx:{fontWeight:600,fontSize:"1.5rem"},children:"Chats"}),(0,r.jsx)(u.Lm,{variant:"icon",sx:{fontSize:"1.5rem"}})]}),(0,r.jsx)(i.default,{sx:{flex:1,overflow:"auto",pb:8},children:k.map(t=>(0,r.jsx)(h.ChatListItem,{chatSession:t,onClick:()=>{var a;return a=t.id,void e.push("/chat/".concat(a))},unread:(t.unreadCount||0)>0},t.id))})]})}),(0,r.jsx)(f.default,{unreadChatsCount:S,unreadNotificationsCount:a,activeOrdersCount:m})]})}},97704:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>p});var r=a(95155),i=a(12115),n=a(35695),s=a(18407),o=a(40541),c=a(9111),l=a(26564),d=a(11335),u=a(21888),h=a(43290),f=a(60807);let x=e=>e>99?"99+":e,p=(0,i.memo)(function(){let{className:e,unreadChatsCount:t=0,activeOrdersCount:a=0,unreadNotificationsCount:p=0,userRole:g}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},m=(0,n.useRouter)(),b=(0,n.usePathname)(),[v,y]=(0,i.useState)(()=>localStorage.getItem("userRole"));(0,i.useEffect)(()=>{if(!g){let e=null;b.startsWith("/available-deliveries")?e="picker":b.startsWith("/delivery-methods")&&(e="sender"),e&&e!==v&&(y(e),localStorage.setItem("userRole",e))}},[b,g,v]);let j=g||v,C=(0,i.useMemo)(()=>b.startsWith("/delivery-methods")||b.startsWith("/orders")||b.startsWith("/available-deliveries")?0:b.startsWith("/chat")?1:b.startsWith("/notifications")?2:3*!!b.startsWith("/profile"),[b]),[w,k]=(0,i.useState)(C),S=(0,i.useCallback)((e,t)=>{switch(k(t),t){case 0:"picker"===j?m.push("/available-deliveries"):m.push("/delivery-methods");break;case 1:m.push("/chats");break;case 2:m.push("/notifications");break;case 3:m.push("/profile")}},[m,j]);return(0,r.jsx)(s.A,{className:e,sx:{position:"fixed",bottom:0,left:0,right:0,width:"100vw",zIndex:1200,paddingBottom:"env(safe-area-inset-bottom)",paddingLeft:0,paddingRight:0,backgroundColor:"background.paper",borderTop:1,borderColor:"divider",borderRadius:0,boxShadow:"0px -2px 4px rgba(0, 0, 0, 0.1)"},elevation:0,children:(0,r.jsxs)(o.A,{value:w,onChange:S,sx:{backgroundColor:"background.paper",width:"100%",height:"68px",paddingLeft:"env(safe-area-inset-left)",paddingRight:"env(safe-area-inset-right)"},children:[(0,r.jsx)(c.A,{label:"Orders",icon:(0,r.jsx)(l.default,{badgeContent:x(a),color:"error",max:99,sx:{"& .MuiBadge-badge":{backgroundColor:"#FF9500",color:"#000000",fontWeight:600}},children:(0,r.jsx)(d.default,{})})}),(0,r.jsx)(c.A,{label:"Chat",icon:(0,r.jsx)(l.default,{badgeContent:x(t),color:"error",max:99,sx:{"& .MuiBadge-badge":{backgroundColor:"#FF9500",color:"#000000",fontWeight:600}},children:(0,r.jsx)(u.A,{})})}),(0,r.jsx)(c.A,{label:"Notifications",icon:(0,r.jsx)(l.default,{badgeContent:x(p),color:"error",max:99,sx:{"& .MuiBadge-badge":{backgroundColor:"#FF9500",color:"#000000",fontWeight:600}},children:(0,r.jsx)(h.A,{})})}),(0,r.jsx)(c.A,{label:"Profile",icon:(0,r.jsx)(f.default,{})})]})})})}},e=>{e.O(0,[3965,7225,9313,1623,3806,8534,1101,5207,8449,1190,9283,1986,7262,2649,7212,1726,8343,8441,5964,7358],()=>e(e.s=37776)),_N_E=e.O()}]);