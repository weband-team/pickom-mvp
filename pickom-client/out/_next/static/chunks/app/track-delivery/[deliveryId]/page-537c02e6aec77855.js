(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8869],{21888:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var i=a(31418),n=a(95155);let r=(0,i.A)((0,n.jsx)("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2M6 9h12v2H6zm8 5H6v-2h8zm4-6H6V6h12z"}),"Chat")},38464:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var i=a(31418),n=a(95155);let r=(0,i.A)((0,n.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack")},41218:(e,t,a)=>{"use strict";a.d(t,{A:()=>h});var i=a(12115),n=a(52596),r=a(17472),o=a(75955),s=a(10186),l=a(18407),c=a(55170),d=a(90870);function u(e){return(0,d.Ay)("MuiCard",e)}(0,c.A)("MuiCard",["root"]);var x=a(95155);let f=(0,o.Ay)(l.A,{name:"MuiCard",slot:"Root"})({overflow:"hidden"}),h=i.forwardRef(function(e,t){let a=(0,s.b)({props:e,name:"MuiCard"}),{className:i,raised:o=!1,...l}=a,c={...a,raised:o},d=(e=>{let{classes:t}=e;return(0,r.A)({root:["root"]},u,t)})(c);return(0,x.jsx)(f,{className:(0,n.A)(d.root,i),elevation:o?8:void 0,ref:t,ownerState:c,...l})})},57316:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});let i=(0,a(11772).Ay)()},59772:(e,t,a)=>{Promise.resolve().then(a.bind(a,92117))},71803:(e,t,a)=>{"use strict";a.d(t,{A:()=>y});var i=a(12115),n=a(52596),r=a(72890),o=a(90870),s=a(17472),l=a(57316),c=a(25560),d=a(5300),u=a(85799),x=a(648),f=a(83130),h=a(95155);let p=(0,u.A)(),m=(0,l.A)("div",{name:"MuiStack",slot:"Root"});function v(e){return(0,c.A)({props:e,name:"MuiStack",defaultTheme:p})}let j=e=>{let{ownerState:t,theme:a}=e,i={display:"flex",flexDirection:"column",...(0,x.NI)({theme:a},(0,x.kW)({values:t.direction,breakpoints:a.breakpoints.values}),e=>({flexDirection:e}))};if(t.spacing){let e=(0,f.LX)(a),n=Object.keys(a.breakpoints.values).reduce((e,a)=>(("object"==typeof t.spacing&&null!=t.spacing[a]||"object"==typeof t.direction&&null!=t.direction[a])&&(e[a]=!0),e),{}),o=(0,x.kW)({values:t.direction,base:n}),s=(0,x.kW)({values:t.spacing,base:n});"object"==typeof o&&Object.keys(o).forEach((e,t,a)=>{if(!o[e]){let i=t>0?o[a[t-1]]:"column";o[e]=i}}),i=(0,r.A)(i,(0,x.NI)({theme:a},s,(a,i)=>t.useFlexGap?{gap:(0,f._W)(e,a)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{["margin".concat({row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"}[i?o[i]:t.direction])]:(0,f._W)(e,a)}}))}return(0,x.iZ)(a.breakpoints,i)};var g=a(75955),b=a(10186);let y=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{createStyledComponent:t=m,useThemeProps:a=v,componentName:r="MuiStack"}=e,l=t(j);return i.forwardRef(function(e,t){let c=a(e),{component:u="div",direction:x="column",spacing:f=0,divider:p,children:m,className:v,useFlexGap:j=!1,...g}=(0,d.A)(c),b=(0,s.A)({root:["root"]},e=>(0,o.Ay)(r,e),{});return(0,h.jsx)(l,{as:u,ownerState:{direction:x,spacing:f,useFlexGap:j},ref:t,className:(0,n.A)(b.root,v),...g,children:p?function(e,t){let a=i.Children.toArray(e).filter(Boolean);return a.reduce((e,n,r)=>(e.push(n),r<a.length-1&&e.push(i.cloneElement(t,{key:"separator-".concat(r)})),e),[])}(m,p):m})})}({createStyledComponent:(0,g.Ay)("div",{name:"MuiStack",slot:"Root"}),useThemeProps:e=>(0,b.b)({props:e,name:"MuiStack"})})},92117:(e,t,a)=>{"use strict";a.d(t,{default:()=>_});var i=a(95155),n=a(12115),r=a(35695),o=a(55028),s=a(54581),l=a(14426),c=a(92302),d=a(3127),u=a(71116),x=a(71803),f=a(41101),h=a(41218),p=a(74964),m=a(42663),v=a(38464),j=a(31418);let g=(0,j.A)((0,i.jsx)("path",{d:"M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5m0-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"}),"RadioButtonChecked"),b=(0,j.A)((0,i.jsx)("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check"),y=(0,j.A)((0,i.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2"}),"Circle");var k=a(68558),A=a(21888),w=a(26290);let C=(0,j.A)((0,i.jsx)("path",{d:"M12 2 4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"}),"Navigation");var S=a(43452),I=a(58343),W=a(21787),z=a(6864),L=a(3376),M=a(86335);let N=(0,o.default)(()=>Promise.all([a.e(9484),a.e(1761),a.e(3406)]).then(a.bind(a,13406)),{loadableGenerated:{webpack:()=>[13406]},ssr:!1,loading:()=>(0,i.jsx)(s.default,{sx:{height:"60vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"background.default"},children:(0,i.jsx)(l.default,{})})});function _(e){var t,o;let{params:j}=e,_=(0,r.useRouter)(),D=(0,n.use)(j),E=null==D?void 0:D.deliveryId,[P,R]=(0,n.useState)(null),[H,F]=(0,n.useState)(null),[T,$]=(0,n.useState)(null),[B,G]=(0,n.useState)(null),[O,U]=(0,n.useState)(!0),[V,X]=(0,n.useState)(""),[K,Y]=(0,n.useState)(null),[Z,q]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{try{let e=await (0,z.HW)();Y(e.user)}catch(e){console.error("Error loading current user:",e)}})()},[]);let J=K&&H&&K.id===H.id,Q=K&&P&&K.uid===P.senderId;(0,L.c)({deliveryId:Number(E),userId:(null==K?void 0:K.id)||0,enabled:!!J&&((null==P?void 0:P.status)==="picked_up"||(null==P?void 0:P.status)==="accepted"),onPermissionDenied:()=>{q(!1)},onPermissionGranted:()=>{q(!0)}});let{isConnected:ee}=(0,L.E)({deliveryId:Number(E),userId:(null==K?void 0:K.id)||0,enabled:!!K&&!!P,onLocationUpdate:e=>{console.log("Picker location updated via WebSocket:",e),$({lat:e.lat,lng:e.lng,timestamp:e.timestamp})},onStatusUpdate:e=>{console.log("Delivery status updated via WebSocket:",e),P&&R({...P,status:e})},onTrackingData:e=>{console.log("Received full tracking data:",e),e.pickerLocation&&$({lat:e.pickerLocation.lat,lng:e.pickerLocation.lng,timestamp:e.pickerLocation.timestamp})},onError:e=>{console.error("WebSocket error:",e),X(e)}});(0,n.useEffect)(()=>{let e=async()=>{try{U(!0);let e=await (0,W.IT)(Number(E));if(R(e.data),e.data.pickerId){let t=await (0,z.wz)(e.data.pickerId);F(t.user),t.user.location&&$(t.user.location)}U(!1)}catch(e){console.error("Error loading delivery:",e),X("Failed to load delivery information"),U(!1)}};E&&e()},[E]);let et=async(e,t)=>{try{let a="https://router.project-osrm.org/route/v1/driving/".concat(e.lng,",").concat(e.lat,";").concat(t.lng,",").concat(t.lat,"?overview=full&geometries=geojson"),i=await fetch(a),n=await i.json();if("Ok"!==n.code||!n.routes||0===n.routes.length)return{distance:"N/A",duration:"N/A",coordinates:[[e.lat,e.lng],[t.lat,t.lng]]};let r=n.routes[0],o=r.geometry.coordinates.map(e=>[e[1],e[0]]);return{distance:"".concat((r.distance/1e3).toFixed(1)," km"),duration:"".concat(Math.round(r.duration/60)," min"),coordinates:o}}catch(a){return console.error("Route calculation error:",a),{distance:"N/A",duration:"N/A",coordinates:[[e.lat,e.lng],[t.lat,t.lng]]}}};(0,n.useEffect)(()=>{T&&(null==P?void 0:P.toLocation)&&(async()=>{try{let e=await et(T,P.toLocation);G(e)}catch(e){console.error("Error calculating route:",e)}})()},[T,null==P?void 0:P.toLocation]);let ea=async()=>{if(H)try{let{createChat:e}=await a.e(6509).then(a.bind(a,16509)),{chatId:t}=(await e({participantId:H.uid,deliveryId:parseInt(E)})).data;_.push("/chat/".concat(t))}catch(e){console.error("Error creating chat:",e)}};if(O)return(0,i.jsx)(S.MobileContainer,{showFrame:!1,children:(0,i.jsx)(s.default,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh"},children:(0,i.jsx)(l.default,{})})});if(V||!P)return(0,i.jsx)(S.MobileContainer,{showFrame:!1,children:(0,i.jsxs)(s.default,{sx:{p:2},children:[(0,i.jsx)(c.A,{severity:"error",children:V||"Delivery not found"}),(0,i.jsx)(I.$n,{variant:"outlined",onClick:()=>_.back(),sx:{mt:2},children:"Go Back"})]})});let ei="PCK".concat(P.id.toString().padStart(6,"0")),en=ee&&("picked_up"===P.status||"accepted"===P.status)&&T;return(0,i.jsx)(S.MobileContainer,{showFrame:!1,children:(0,i.jsxs)(s.default,{sx:{display:"flex",flexDirection:"column",height:"100vh",backgroundColor:"background.default"},children:[(0,i.jsxs)(s.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:2,backgroundColor:"background.paper",borderBottom:1,borderColor:"divider",boxShadow:1},children:[(0,i.jsxs)(s.default,{sx:{display:"flex",alignItems:"center",flex:1},children:[(0,i.jsx)(d.A,{onClick:()=>_.back(),sx:{mr:1},children:(0,i.jsx)(v.A,{})}),(0,i.jsxs)(s.default,{children:[(0,i.jsx)(u.default,{variant:"h6",sx:{fontWeight:600,fontSize:"1.125rem"},children:"Track Delivery"}),(0,i.jsx)(u.default,{variant:"caption",color:"text.secondary",children:ei})]})]}),(0,i.jsxs)(x.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,i.jsx)(f.A,{label:P.status.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),color:(e=>{switch(e){case"pending":return"warning";case"accepted":return"info";case"picked_up":return"primary";case"delivered":return"success";case"cancelled":return"error";default:return"default"}})(P.status),size:"small",sx:{fontWeight:600}}),en&&(0,i.jsx)(f.A,{label:"Live",size:"small",sx:{backgroundColor:"#4caf50",color:"white",fontWeight:600,animation:"pulse 2s infinite","@keyframes pulse":{"0%":{opacity:1},"50%":{opacity:.7},"100%":{opacity:1}}},icon:(0,i.jsx)(g,{sx:{fontSize:16,color:"white !important"}})})]})]}),(0,i.jsxs)(s.default,{sx:{height:"60vh",position:"relative"},children:[(0,i.jsx)(N,{delivery:P,picker:H,pickerLocation:T,route:B}),B&&T&&"picked_up"===P.status&&(0,i.jsx)(h.A,{sx:{position:"absolute",top:16,left:"50%",transform:"translateX(-50%)",zIndex:1e3,px:2,py:1,boxShadow:3},children:(0,i.jsxs)(x.A,{direction:"row",spacing:2,alignItems:"center",children:[(0,i.jsxs)(s.default,{children:[(0,i.jsx)(u.default,{variant:"caption",color:"text.secondary",children:"ETA"}),(0,i.jsx)(u.default,{variant:"body2",sx:{fontWeight:600},children:B.duration})]}),(0,i.jsx)(p.A,{orientation:"vertical",flexItem:!0}),(0,i.jsxs)(s.default,{children:[(0,i.jsx)(u.default,{variant:"caption",color:"text.secondary",children:"Distance"}),(0,i.jsx)(u.default,{variant:"body2",sx:{fontWeight:600},children:B.distance})]})]})})]}),(0,i.jsxs)(s.default,{sx:{flex:1,overflow:"auto",p:2,pb:10},children:[(0,i.jsxs)(h.A,{sx:{mb:2,p:2},children:[(0,i.jsx)(u.default,{variant:"subtitle2",sx:{mb:2,fontWeight:600},children:"Delivery Progress"}),(0,i.jsxs)(x.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,i.jsxs)(s.default,{sx:{display:"flex",flexDirection:"column",alignItems:"center",flex:1},children:["accepted"===P.status||"picked_up"===P.status||"delivered"===P.status?(0,i.jsx)(b,{sx:{color:"success.main",fontSize:28}}):(0,i.jsx)(y,{sx:{color:"text.disabled",fontSize:20}}),(0,i.jsx)(u.default,{variant:"caption",sx:{mt:.5,fontWeight:"accepted"===P.status?600:400},children:"Accepted"}),P.createdAt&&(0,i.jsx)(u.default,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.65rem"},children:(0,M.GP)(new Date(P.createdAt),"HH:mm")})]}),(0,i.jsx)(s.default,{sx:{height:2,flex:1,backgroundColor:"picked_up"===P.status||"delivered"===P.status?"success.main":"divider"}}),(0,i.jsxs)(s.default,{sx:{display:"flex",flexDirection:"column",alignItems:"center",flex:1},children:["picked_up"===P.status||"delivered"===P.status?(0,i.jsx)(b,{sx:{color:"success.main",fontSize:28}}):(0,i.jsx)(y,{sx:{color:"text.disabled",fontSize:20}}),(0,i.jsx)(u.default,{variant:"caption",sx:{mt:.5,fontWeight:"picked_up"===P.status?600:400},children:"Picked Up"}),(0,i.jsx)(u.default,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.65rem"},children:"picked_up"===P.status||"delivered"===P.status?(0,M.GP)(new Date,"HH:mm"):"Pending"})]}),(0,i.jsx)(s.default,{sx:{height:2,flex:1,backgroundColor:"delivered"===P.status?"success.main":"divider"}}),(0,i.jsxs)(s.default,{sx:{display:"flex",flexDirection:"column",alignItems:"center",flex:1},children:["delivered"===P.status?(0,i.jsx)(b,{sx:{color:"success.main",fontSize:28}}):(0,i.jsx)(y,{sx:{color:"text.disabled",fontSize:20}}),(0,i.jsx)(u.default,{variant:"caption",sx:{mt:.5,fontWeight:"delivered"===P.status?600:400},children:"Delivered"}),(0,i.jsx)(u.default,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.65rem"},children:(null==B?void 0:B.duration)||"Est."})]})]})]}),H&&(0,i.jsxs)(h.A,{sx:{mb:2,p:2},children:[(0,i.jsx)(u.default,{variant:"subtitle2",sx:{mb:2,fontWeight:600},children:J?"You are the Picker":"Courier Information"}),(0,i.jsxs)(x.A,{direction:"row",spacing:2,alignItems:"center",children:[(0,i.jsx)(m.default,{src:H.avatarUrl,sx:{width:56,height:56},children:H.name.charAt(0)}),(0,i.jsxs)(s.default,{sx:{flex:1},children:[(0,i.jsx)(u.default,{variant:"body1",sx:{fontWeight:600},children:H.name}),(0,i.jsxs)(x.A,{direction:"row",spacing:.5,alignItems:"center",children:[(0,i.jsx)(k.default,{sx:{fontSize:16,color:"#ffc107"}}),(0,i.jsxs)(u.default,{variant:"body2",color:"text.secondary",children:[H.rating?Number(H.rating).toFixed(1):"N/A"," (",H.totalRatings||0,")"]})]}),(0,i.jsxs)(u.default,{variant:"caption",color:"text.secondary",children:[H.completedDeliveries||0," completed deliveries"]})]})]}),!J&&(0,i.jsxs)(x.A,{direction:"row",spacing:1,sx:{mt:2},children:[(0,i.jsx)(I.$n,{variant:"outlined",size:"small",fullWidth:!0,startIcon:(0,i.jsx)(A.A,{}),onClick:ea,children:"Chat"}),H.phone&&(0,i.jsx)(I.$n,{variant:"outlined",size:"small",fullWidth:!0,startIcon:(0,i.jsx)(w.default,{}),onClick:()=>window.open("tel:".concat(H.phone),"_self"),children:"Call"})]}),J&&"accepted"===P.status&&(0,i.jsxs)(x.A,{direction:"row",spacing:1,sx:{mt:2},children:[(0,i.jsx)(I.$n,{variant:"contained",size:"small",fullWidth:!0,startIcon:(0,i.jsx)(C,{}),onClick:()=>{if(!(null==P?void 0:P.toLocation))return;let e="https://www.google.com/maps/dir/?api=1&destination=".concat(P.toLocation.lat,",").concat(P.toLocation.lng);window.open(e,"_blank")},children:"Navigate"}),(0,i.jsx)(I.$n,{variant:"outlined",size:"small",fullWidth:!0,startIcon:(0,i.jsx)(A.A,{}),onClick:ea,children:"Chat"})]})]}),(0,i.jsxs)(h.A,{sx:{p:2},children:[(0,i.jsx)(u.default,{variant:"subtitle2",sx:{mb:2,fontWeight:600},children:"Package Details"}),(0,i.jsxs)(s.default,{sx:{mb:2},children:[(0,i.jsx)(u.default,{variant:"caption",color:"text.secondary",children:"From"}),(0,i.jsx)(u.default,{variant:"body2",sx:{fontWeight:500},children:(null==(t=P.fromLocation)?void 0:t.address)||"N/A"})]}),(0,i.jsxs)(s.default,{sx:{mb:2},children:[(0,i.jsx)(u.default,{variant:"caption",color:"text.secondary",children:"To"}),(0,i.jsx)(u.default,{variant:"body2",sx:{fontWeight:500},children:(null==(o=P.toLocation)?void 0:o.address)||"N/A"})]}),(0,i.jsxs)(x.A,{direction:"row",spacing:2,sx:{mb:1},children:[(0,i.jsxs)(s.default,{sx:{flex:1},children:[(0,i.jsx)(u.default,{variant:"caption",color:"text.secondary",children:"Size"}),(0,i.jsx)(u.default,{variant:"body2",sx:{fontWeight:600},children:P.size})]}),P.weight&&(0,i.jsxs)(s.default,{sx:{flex:1},children:[(0,i.jsx)(u.default,{variant:"caption",color:"text.secondary",children:"Weight"}),(0,i.jsxs)(u.default,{variant:"body2",sx:{fontWeight:600},children:[P.weight," kg"]})]}),(0,i.jsxs)(s.default,{sx:{flex:1},children:[(0,i.jsx)(u.default,{variant:"caption",color:"text.secondary",children:"Price"}),(0,i.jsxs)(u.default,{variant:"body2",sx:{fontWeight:600,color:"primary.main"},children:["$",P.price]})]})]}),P.description&&(0,i.jsxs)(s.default,{sx:{mt:2,p:1.5,backgroundColor:"background.default",borderRadius:1},children:[(0,i.jsx)(u.default,{variant:"caption",color:"text.secondary",children:"Description"}),(0,i.jsx)(u.default,{variant:"body2",children:P.description})]})]})]}),Q&&"delivered"===P.status&&(0,i.jsx)(s.default,{sx:{position:"fixed",bottom:0,left:0,right:0,p:2,backgroundColor:"background.paper",borderTop:1,borderColor:"divider",boxShadow:3},children:(0,i.jsx)(I.$n,{variant:"contained",fullWidth:!0,onClick:()=>_.push("/rate-picker/".concat(P.id)),startIcon:(0,i.jsx)(k.default,{}),children:"Rate Picker"})})]})})}}},e=>{e.O(0,[3965,7225,3964,8202,6592,8534,7844,1101,5207,8652,8449,1190,7615,1986,2649,7212,4874,8343,5053,8441,5964,7358],()=>e(e.s=59772)),_N_E=e.O()}]);