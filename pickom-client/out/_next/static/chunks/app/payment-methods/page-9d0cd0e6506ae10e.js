(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6272],{19034:(e,t,r)=>{Promise.resolve().then(r.bind(r,97023))},44291:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var a=r(95155),s=r(12115),i=r(31545),l=r(54581),d=r(71116),o=r(92302),n=r(68534),c=r(14426),h=r(31530),x=r(23464);function u(e){let{onSuccess:t,onCancel:r}=e,u=(0,i.t2)(),f=(0,i.HH)(),[m,p]=(0,s.useState)(!1),[j,y]=(0,s.useState)(""),b=async e=>{if(e.preventDefault(),!u||!f)return void y("Stripe is not loaded. Please refresh the page.");p(!0),y("");try{let{data:e}=await x.A.post("".concat("https://pickom.qirelab.com","/payment/cards/setup-intent"),{},{withCredentials:!0}),{clientSecret:r}=e,a=f.getElement(i.hA);if(!a)throw Error("Card element not found");let{error:s,setupIntent:l}=await u.confirmCardSetup(r,{payment_method:{card:a}});if(s){y(s.message||"Card verification failed"),h.toast.error("Failed to add card");return}if((null==l?void 0:l.status)==="succeeded"){let e=l.payment_method;await x.A.post("".concat("https://pickom.qirelab.com","/payment/cards/attach"),{paymentMethodId:e},{withCredentials:!0}),h.toast.success("Card added successfully!"),null==t||t()}}catch(t){var r,a;console.error("Error adding card:",t);let e=(null==(a=t.response)||null==(r=a.data)?void 0:r.message)||"Failed to add card. Please try again.";y(e),h.toast.error(e)}finally{p(!1)}};return(0,a.jsxs)(l.default,{component:"form",onSubmit:b,children:[(0,a.jsx)(d.default,{variant:"h6",gutterBottom:!0,children:"Add Payment Card"}),j&&(0,a.jsx)(o.A,{severity:"error",sx:{mb:2},children:j}),(0,a.jsx)(l.default,{sx:{p:2,border:1,borderColor:"divider",borderRadius:2,mb:3,backgroundColor:"#f5f5f5"},children:(0,a.jsx)(i.hA,{options:{style:{base:{fontSize:"16px",color:"#000000",fontFamily:"Roboto, sans-serif","::placeholder":{color:"#757575"}},invalid:{color:"#d32f2f"}},hidePostalCode:!0}})}),(0,a.jsxs)(l.default,{sx:{display:"flex",gap:2},children:[r&&(0,a.jsx)(n.A,{onClick:r,disabled:m,fullWidth:!0,variant:"outlined",size:"large",children:"Cancel"}),(0,a.jsx)(n.A,{type:"submit",disabled:!u||m,fullWidth:!0,variant:"contained",size:"large",children:m?(0,a.jsx)(c.default,{size:24}):"Add Card"})]})]})}},80775:(e,t,r)=>{"use strict";r.d(t,{A:()=>S});var a=r(95155),s=r(12115),i=r(54581),l=r(14426),d=r(92302),o=r(71803),n=r(23464),c=r(31530),h=r(71116),x=r(41101),u=r(3127),f=r(74802),m=r(19505),p=r(78921),j=r(72093);let y=e=>(0,a.jsxs)(p.default,{...e,viewBox:"0 0 48 32",children:[(0,a.jsx)("rect",{width:"48",height:"32",rx:"4",fill:"#1434CB"}),(0,a.jsx)("text",{x:"24",y:"20",fontSize:"12",fill:"white",textAnchor:"middle",fontWeight:"bold",children:"VISA"})]}),b=e=>(0,a.jsxs)(p.default,{...e,viewBox:"0 0 48 32",children:[(0,a.jsx)("rect",{width:"48",height:"32",rx:"4",fill:"#000000"}),(0,a.jsx)("circle",{cx:"19",cy:"16",r:"8",fill:"#EB001B"}),(0,a.jsx)("circle",{cx:"29",cy:"16",r:"8",fill:"#F79E1B"})]}),g=e=>(0,a.jsxs)(p.default,{...e,viewBox:"0 0 48 32",children:[(0,a.jsx)("rect",{width:"48",height:"32",rx:"4",fill:"#006FCF"}),(0,a.jsx)("text",{x:"24",y:"20",fontSize:"10",fill:"white",textAnchor:"middle",fontWeight:"bold",children:"AMEX"})]}),v=e=>(0,a.jsxs)(p.default,{...e,viewBox:"0 0 48 32",children:[(0,a.jsx)("rect",{width:"48",height:"32",rx:"4",fill:"#4DB45E"}),(0,a.jsx)("text",{x:"24",y:"20",fontSize:"12",fill:"white",textAnchor:"middle",fontWeight:"bold",children:"MIR"})]}),A=e=>(0,a.jsxs)(p.default,{...e,viewBox:"0 0 48 32",children:[(0,a.jsx)("rect",{width:"48",height:"32",rx:"4",fill:"#FF6000"}),(0,a.jsx)("text",{x:"24",y:"20",fontSize:"9",fill:"white",textAnchor:"middle",fontWeight:"bold",children:"DISCOVER"})]});function C(e){let{brand:t,size:r="medium"}=e,s={visa:y,mastercard:b,amex:g,"american express":g,mir:v,discover:A}[t.toLowerCase()]||j.default;return(0,a.jsx)(s,{sx:{small:{width:32,height:20},medium:{width:48,height:32},large:{width:64,height:42}}[r]})}function w(e){let{card:t,onDelete:r,onSetDefault:s,onSelect:l,selectable:d=!1}=e;return(0,a.jsxs)(i.default,{onClick:()=>{d&&l&&l(t.id)},sx:{p:2,border:1,borderColor:t.isDefault?"primary.main":"divider",borderRadius:2,display:"flex",alignItems:"center",gap:2,cursor:d?"pointer":"default","&:hover":d?{backgroundColor:"action.hover"}:{}},children:[(0,a.jsx)(C,{brand:t.brand,size:"medium"}),(0,a.jsxs)(i.default,{sx:{flex:1},children:[(0,a.jsxs)(h.default,{variant:"body1",sx:{fontWeight:600},children:["•••• ",t.lastFourDigits]}),(0,a.jsxs)(h.default,{variant:"caption",color:"text.secondary",children:["Expires ",String(t.expMonth).padStart(2,"0"),"/",t.expYear]})]}),t.isDefault&&(0,a.jsx)(x.A,{label:"Default",size:"small",color:"primary",icon:(0,a.jsx)(f.default,{}),sx:{mr:1}}),!t.isDefault&&s&&(0,a.jsx)(x.A,{label:"Set Default",size:"small",variant:"outlined",onClick:e=>{e.stopPropagation(),s(t.id)},clickable:!0}),r&&(0,a.jsx)(u.A,{onClick:e=>{e.stopPropagation(),r(t.id)},color:"error",size:"small",children:(0,a.jsx)(m.A,{})})]})}function S(e){let{onCardSelect:t,selectable:r=!1,showActions:h=!0}=e,[x,u]=(0,s.useState)([]),[f,m]=(0,s.useState)(!0),[p,j]=(0,s.useState)(""),y=async()=>{m(!0),j("");try{let{data:e}=await n.A.get("".concat("https://pickom.qirelab.com","/payment/cards"),{withCredentials:!0});u(e)}catch(r){var e,t;console.error("Error fetching cards:",r),j((null==(t=r.response)||null==(e=t.data)?void 0:e.message)||"Failed to load cards")}finally{m(!1)}};(0,s.useEffect)(()=>{y()},[]);let b=async e=>{if(confirm("Are you sure you want to delete this card?"))try{await n.A.delete("".concat("https://pickom.qirelab.com","/payment/cards/").concat(e),{withCredentials:!0}),c.toast.success("Card deleted successfully"),y()}catch(a){var t,r;console.error("Error deleting card:",a);let e=(null==(r=a.response)||null==(t=r.data)?void 0:t.message)||"Failed to delete card";c.toast.error(e)}},g=async e=>{try{await n.A.put("".concat("https://pickom.qirelab.com","/payment/cards/").concat(e,"/default"),{},{withCredentials:!0}),c.toast.success("Default card updated"),y()}catch(a){var t,r;console.error("Error setting default card:",a);let e=(null==(r=a.response)||null==(t=r.data)?void 0:t.message)||"Failed to set default card";c.toast.error(e)}};return f?(0,a.jsx)(i.default,{sx:{display:"flex",justifyContent:"center",p:4},children:(0,a.jsx)(l.default,{})}):p?(0,a.jsx)(d.A,{severity:"error",sx:{mb:2},children:p}):0===x.length?(0,a.jsx)(d.A,{severity:"info",sx:{mb:2},children:"No payment cards saved yet. Add a card to get started."}):(0,a.jsx)(o.A,{spacing:2,children:x.map(e=>(0,a.jsx)(w,{card:e,onDelete:h?b:void 0,onSetDefault:h?g:void 0,onSelect:t,selectable:r},e.id))})}},97023:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var a=r(95155),s=r(12115),i=r(67217),l=r(54581),d=r(3127),o=r(71116),n=r(68534),c=r(18407),h=r(36114),x=r(54492),u=r(99927),f=r(38464),m=r(40857),p=r(69242),j=r(35695),y=r(80775),b=r(44291);function g(){let e=(0,j.useRouter)(),[t,r]=(0,s.useState)(!1),[g,v]=(0,s.useState)(0);return(0,a.jsxs)(i.A,{maxWidth:"md",sx:{py:4},children:[(0,a.jsxs)(l.default,{sx:{mb:4},children:[(0,a.jsxs)(l.default,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,a.jsx)(d.A,{onClick:()=>e.back(),sx:{mr:1},children:(0,a.jsx)(f.A,{})}),(0,a.jsx)(o.default,{variant:"h4",component:"h1",children:"Payment Methods"})]}),(0,a.jsx)(o.default,{variant:"body2",color:"text.secondary",children:"Manage your saved payment cards"})]}),(0,a.jsx)(n.A,{variant:"contained",startIcon:(0,a.jsx)(m.A,{}),onClick:()=>r(!0),sx:{mb:3},size:"large",children:"Add New Card"}),(0,a.jsx)(c.A,{elevation:0,sx:{p:3,borderRadius:2,border:1,borderColor:"divider"},children:(0,a.jsx)(y.A,{showActions:!0},g)}),(0,a.jsxs)(h.A,{open:t,onClose:()=>r(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[(0,a.jsxs)(x.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:["Add Payment Card",(0,a.jsx)(d.A,{onClick:()=>r(!1),size:"small",children:(0,a.jsx)(p.A,{})})]}),(0,a.jsx)(u.A,{children:(0,a.jsx)(b.A,{onSuccess:()=>{r(!1),v(e=>e+1)},onCancel:()=>r(!1)})})]})]})}}},e=>{e.O(0,[7225,3964,8202,8534,1101,5207,8652,1530,507,7231,8441,5964,7358],()=>e(e.s=19034)),_N_E=e.O()}]);