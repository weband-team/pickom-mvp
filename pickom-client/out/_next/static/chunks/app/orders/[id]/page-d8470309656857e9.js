(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6040],{16673:(e,t,r)=>{Promise.resolve().then(r.bind(r,95714))},70978:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var i=r(31418),a=r(95155);let n=(0,i.A)((0,a.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning")},91204:(e,t,r)=>{"use strict";r.d(t,{$2:()=>n,HX:()=>a,Re:()=>i,dH:()=>d,po:()=>s,ps:()=>l,qY:()=>c});var i=function(e){return e.PENDING="pending",e.ACTIVE="active",e.COMPLETED="completed",e.CANCELLED="cancelled",e}({});function a(e){return"pending"===e.status||"active"===e.status}function n(e){return"completed"===e.status&&!e.review}function s(e){return"active"===e.status&&!!e.picker}function c(e){switch(e){case"pending":return"#FF9500";case"active":return"#2196F3";case"completed":return"#4CAF50";default:return"#9E9E9E"}}function l(e){switch(e){case"pending":return"Pending";case"active":return"Active";case"completed":return"Completed";case"cancelled":return"Cancelled";default:return"Unknown"}}function d(e){let t=e.pickup.city||e.pickup.address,r=e.dropoff.city||e.dropoff.address;return"".concat(t," → ").concat(r)}},95714:(e,t,r)=>{"use strict";r.d(t,{default:()=>H});var i=r(95155),a=r(12115),n=r(54581),s=r(14426),c=r(92302),l=r(3127),d=r(71116),o=r(71803),u=r(41101),x=r(74964),f=r(38464),h=r(52836),p=r(64341),v=r(11335);let m=(0,r(31418).A)((0,i.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh");var y=r(35695),j=r(43452),b=r(58343),g=r(97704),k=r(91204),C=r(86335),A=r(36114),w=r(54492),I=r(99927),P=r(71977),D=r(70978);function E(e){let{open:t,orderTrackingNumber:r,onConfirm:a,onCancel:s}=e;return(0,i.jsxs)(A.A,{open:t,onClose:s,maxWidth:"xs",fullWidth:!0,sx:{"& .MuiDialog-paper":{margin:"var(--safe-area-top) var(--safe-area-right) var(--safe-area-bottom) var(--safe-area-left)"}},children:[(0,i.jsx)(w.A,{children:(0,i.jsxs)(n.default,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,i.jsx)(D.A,{sx:{color:"warning.main"}}),(0,i.jsx)(d.default,{variant:"h6",children:"Cancel Order?"})]})}),(0,i.jsxs)(I.A,{children:[(0,i.jsxs)(d.default,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Are you sure you want to cancel order ",(0,i.jsx)("strong",{children:r}),"?"]}),(0,i.jsx)(d.default,{variant:"body2",color:"text.secondary",children:"This action cannot be undone."})]}),(0,i.jsxs)(P.A,{sx:{px:3,pb:2},children:[(0,i.jsx)(b.$n,{variant:"outlined",onClick:s,fullWidth:!0,children:"No, Keep Order"}),(0,i.jsx)(b.$n,{variant:"contained",onClick:a,color:"error",fullWidth:!0,children:"Yes, Cancel Order"})]})]})}var N=r(1154),R=r(78449),S=r(68558);function W(e){let{open:t,pickerName:r,onSubmit:s,onCancel:c}=e,[l,o]=(0,a.useState)(5),[u,x]=(0,a.useState)(""),f=()=>{c(),o(5),x("")};return(0,i.jsxs)(A.A,{open:t,onClose:f,maxWidth:"sm",fullWidth:!0,sx:{"& .MuiDialog-paper":{margin:"var(--safe-area-top) var(--safe-area-right) var(--safe-area-bottom) var(--safe-area-left)"}},children:[(0,i.jsx)(w.A,{children:(0,i.jsx)(d.default,{variant:"h6",children:"Leave a Review"})}),(0,i.jsxs)(I.A,{children:[(0,i.jsxs)(d.default,{variant:"body2",color:"text.secondary",sx:{mb:3},children:["How was your experience with ",(0,i.jsx)("strong",{children:r}),"?"]}),(0,i.jsxs)(n.default,{sx:{mb:3},children:[(0,i.jsx)(d.default,{variant:"body2",sx:{mb:1},children:"Rating"}),(0,i.jsx)(N.A,{value:l,onChange:(e,t)=>{null!==t&&o(t)},size:"large",icon:(0,i.jsx)(S.default,{fontSize:"inherit"}),emptyIcon:(0,i.jsx)(S.default,{fontSize:"inherit"})})]}),(0,i.jsxs)(n.default,{children:[(0,i.jsx)(d.default,{variant:"body2",sx:{mb:1},children:"Comment (optional)"}),(0,i.jsx)(R.default,{fullWidth:!0,multiline:!0,rows:4,value:u,onChange:e=>x(e.target.value),placeholder:"Share your experience...",variant:"outlined"})]})]}),(0,i.jsxs)(P.A,{sx:{px:3,pb:2},children:[(0,i.jsx)(b.$n,{variant:"outlined",onClick:f,fullWidth:!0,children:"Cancel"}),(0,i.jsx)(b.$n,{variant:"contained",onClick:()=>{s(l,u),o(5),x("")},fullWidth:!0,children:"Submit Review"})]})]})}var L=r(70005),M=r(31530),F=r(21787),T=r(6864);function H(e){var t,A,w;let{params:I}=e,P=(0,y.useRouter)(),{orderId:D}=(0,a.use)(I),[N,R]=(0,a.useState)(),[S,H]=(0,a.useState)(null),[z,O]=(0,a.useState)(!0),[$,U]=(0,a.useState)(""),[V,G]=(0,a.useState)(!1),[_,Y]=(0,a.useState)(!1),[q,K]=(0,a.useState)(!1);if((0,a.useEffect)(()=>{(async()=>{try{let{user:e}=await (0,T.HW)();H(e)}catch(e){}})()},[]),(0,a.useEffect)(()=>{(async()=>{O(!0),U("");try{var e,t,r,i;let a,n,s,c=(await (0,F.IT)(parseInt(D))).data;switch(c.status){case"pending":default:a=k.Re.PENDING;break;case"accepted":case"picked_up":a=k.Re.ACTIVE;break;case"delivered":a=k.Re.COMPLETED;break;case"cancelled":a=k.Re.CANCELLED}if(c.pickerId)try{let{user:e}=await (0,T.wz)(c.pickerId);n={id:e.uid,fullName:e.name||"Picker",rating:e.rating||0,avatarUrl:e.avatarUrl}}catch(e){}if(c.recipientId)try{let{user:e}=await (0,T.wz)(c.recipientId);s={id:e.uid,fullName:e.name||"Recipient",rating:e.rating||0,avatarUrl:e.avatarUrl,isPhoneVerified:!0,isEmailVerified:!0}}catch(e){}let l={id:c.id.toString(),trackingNumber:"PCK".concat(c.id.toString().padStart(6,"0")),status:a,deliveryMethod:"within-city",packageType:"SMALL_PARCEL",pickup:{address:null==(e=c.fromLocation)?void 0:e.address,city:null==(t=c.fromLocation)?void 0:t.city},dropoff:{address:null==(r=c.toLocation)?void 0:r.address,city:null==(i=c.toLocation)?void 0:i.city},createdAt:new Date(c.createdAt),pickupDateTime:new Date(c.createdAt),price:c.price,currency:"USD",picker:n,receiver:s,receiverPhone:c.recipientPhone||void 0,recipientConfirmed:c.recipientConfirmed,notes:c.notes||void 0,packageDescription:c.description||void 0};R(l)}catch(e){U("Failed to load order. Please try again.")}finally{O(!1)}})()},[D]),z)return(0,i.jsx)(n.default,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.default"},children:(0,i.jsx)(s.default,{})});if($||!N)return(0,i.jsx)(n.default,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.default",p:2},children:(0,i.jsx)(c.A,{severity:"error",children:$||"Order not found"})});let X=async()=>{if(N.picker)try{let{createChat:e}=await r.e(6509).then(r.bind(r,16509)),{chatId:t}=(await e({participantId:N.picker.id,deliveryId:parseInt(N.id)})).data;P.push("/chat/".concat(t))}catch(e){M.toast.error("Failed to open chat")}},B=async()=>{if(N.receiver)try{let{createChat:e}=await r.e(6509).then(r.bind(r,16509)),{chatId:t}=(await e({participantId:N.receiver.id,deliveryId:parseInt(N.id)})).data;P.push("/chat/".concat(t))}catch(e){M.toast.error("Failed to open chat")}},J=async()=>{if(N){K(!0);try{await (0,F.confirmRecipient)(parseInt(N.id),!0),M.toast.success("Delivery confirmed successfully!");let e=(await (0,F.IT)(parseInt(D))).data;R({...N,recipientConfirmed:e.recipientConfirmed})}catch(e){M.toast.error("Failed to confirm delivery. Please try again.")}finally{K(!1)}}},Q=async()=>{if(N){K(!0);try{await (0,F.confirmRecipient)(parseInt(N.id),!1),M.toast.success("Delivery rejected. Order has been cancelled."),setTimeout(()=>P.push("/orders"),1500)}catch(e){M.toast.error("Failed to reject delivery. Please try again."),K(!1)}}},Z=S&&(null==N||null==(t=N.receiver)?void 0:t.id)===S.uid,ee=Z&&!(null==N?void 0:N.recipientConfirmed)&&(null==N?void 0:N.status)===k.Re.PENDING;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(j.MobileContainer,{showFrame:!1,children:(0,i.jsxs)(n.default,{sx:{display:"flex",flexDirection:"column",height:"100vh",backgroundColor:"background.default"},children:[(0,i.jsxs)(n.default,{sx:{display:"flex",alignItems:"center",p:2,borderBottom:1,borderColor:"divider"},children:[(0,i.jsx)(l.A,{onClick:()=>{P.back()},sx:{mr:1,p:1},children:(0,i.jsx)(f.A,{})}),(0,i.jsx)(d.default,{variant:"h5",sx:{fontWeight:600,fontSize:"1.5rem"},children:"Order Details"})]}),(0,i.jsxs)(n.default,{sx:{flex:1,overflow:"auto",pb:10,px:3,pt:2},children:[(0,i.jsxs)(o.A,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:3},children:[(0,i.jsx)(d.default,{variant:"body2",color:"text.secondary",children:N.trackingNumber}),(0,i.jsx)(u.A,{label:(0,k.ps)(N.status),sx:{backgroundColor:(0,k.qY)(N.status),color:"#fff",fontWeight:"bold"}})]}),(0,i.jsxs)(n.default,{sx:{mb:3},children:[(0,i.jsx)(d.default,{variant:"subtitle2",color:"text.secondary",sx:{mb:1},children:"Route"}),(0,i.jsxs)(o.A,{spacing:2,children:[(0,i.jsxs)(n.default,{sx:{display:"flex",alignItems:"flex-start"},children:[(0,i.jsx)(h.A,{sx:{mr:1,color:"primary.main"}}),(0,i.jsxs)(n.default,{children:[(0,i.jsx)(d.default,{variant:"body2",sx:{fontWeight:600},children:"Pickup"}),(0,i.jsx)(d.default,{variant:"body2",color:"text.secondary",children:N.pickup.address}),N.pickup.city&&(0,i.jsxs)(d.default,{variant:"caption",color:"text.secondary",children:[N.pickup.city,N.pickup.country&&", ".concat(N.pickup.country)]})]})]}),(0,i.jsxs)(n.default,{sx:{display:"flex",alignItems:"flex-start"},children:[(0,i.jsx)(h.A,{sx:{mr:1,color:"error.main"}}),(0,i.jsxs)(n.default,{children:[(0,i.jsx)(d.default,{variant:"body2",sx:{fontWeight:600},children:"Dropoff"}),(0,i.jsx)(d.default,{variant:"body2",color:"text.secondary",children:N.dropoff.address}),N.dropoff.city&&(0,i.jsxs)(d.default,{variant:"caption",color:"text.secondary",children:[N.dropoff.city,N.dropoff.country&&", ".concat(N.dropoff.country)]})]})]})]})]}),(0,i.jsx)(x.A,{sx:{my:3}}),(0,i.jsxs)(n.default,{sx:{mb:3},children:[(0,i.jsx)(d.default,{variant:"subtitle2",color:"text.secondary",sx:{mb:2},children:"Timeline"}),(0,i.jsxs)(o.A,{spacing:1.5,children:[(0,i.jsxs)(n.default,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(p.A,{sx:{fontSize:"1rem",mr:1,color:"text.secondary"}}),(0,i.jsxs)(n.default,{children:[(0,i.jsx)(d.default,{variant:"caption",color:"text.secondary",children:"Created"}),(0,i.jsx)(d.default,{variant:"body2",children:(0,C.GP)(N.createdAt,"MMM dd, yyyy HH:mm")})]})]}),(0,i.jsxs)(n.default,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(v.default,{sx:{fontSize:"1rem",mr:1,color:"text.secondary"}}),(0,i.jsxs)(n.default,{children:[(0,i.jsx)(d.default,{variant:"caption",color:"text.secondary",children:"Scheduled Pickup"}),(0,i.jsx)(d.default,{variant:"body2",children:(0,C.GP)(N.pickupDateTime,"MMM dd, yyyy HH:mm")})]})]}),N.deliveredAt&&(0,i.jsxs)(n.default,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(p.A,{sx:{fontSize:"1rem",mr:1,color:"success.main"}}),(0,i.jsxs)(n.default,{children:[(0,i.jsx)(d.default,{variant:"caption",color:"text.secondary",children:"Delivered"}),(0,i.jsx)(d.default,{variant:"body2",children:(0,C.GP)(N.deliveredAt,"MMM dd, yyyy HH:mm")})]})]}),N.cancelledAt&&(0,i.jsxs)(n.default,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(p.A,{sx:{fontSize:"1rem",mr:1,color:"error.main"}}),(0,i.jsxs)(n.default,{children:[(0,i.jsx)(d.default,{variant:"caption",color:"text.secondary",children:"Cancelled"}),(0,i.jsx)(d.default,{variant:"body2",children:(0,C.GP)(N.cancelledAt,"MMM dd, yyyy HH:mm")})]})]})]})]}),(0,i.jsx)(x.A,{sx:{my:3}}),(0,i.jsxs)(n.default,{sx:{mb:3},children:[(0,i.jsx)(d.default,{variant:"subtitle2",color:"text.secondary",sx:{mb:1},children:"Price"}),(0,i.jsxs)(d.default,{variant:"h5",sx:{fontWeight:"bold",color:"primary.main"},children:[N.price," ",N.currency]})]}),N.picker&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(x.A,{sx:{my:3}}),(0,i.jsxs)(n.default,{sx:{mb:3},children:[(0,i.jsx)(d.default,{variant:"subtitle2",color:"text.secondary",sx:{mb:2},children:"Picker"}),(0,i.jsxs)(o.A,{direction:"row",spacing:2,alignItems:"center",children:[(0,i.jsx)(b.H8,{type:"picker",name:N.picker.fullName,src:N.picker.avatarUrl}),(0,i.jsxs)(n.default,{sx:{flex:1},children:[(0,i.jsx)(d.default,{variant:"body1",sx:{fontWeight:600},children:N.picker.fullName}),(0,i.jsxs)(d.default,{variant:"caption",color:"text.secondary",children:["⭐ ",N.picker.rating.toFixed(1)]})]})]})]})]}),(N.receiver||N.receiverPhone)&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(x.A,{sx:{my:3}}),(0,i.jsxs)(n.default,{sx:{mb:3},children:[(0,i.jsx)(d.default,{variant:"subtitle2",color:"text.secondary",sx:{mb:2},children:"Receiver"}),(0,i.jsx)(L.A,{receiver:{recipientId:null==(A=N.receiver)?void 0:A.id,recipientPhone:N.receiverPhone,recipientUser:N.receiver?{uid:N.receiver.id,fullName:N.receiver.fullName,avatarUrl:N.receiver.avatarUrl,rating:N.receiver.rating,isPhoneVerified:N.receiver.isPhoneVerified,isEmailVerified:N.receiver.isEmailVerified}:void 0},onContactClick:N.receiver?B:void 0,variant:"compact"})]})]}),N.notes&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(x.A,{sx:{my:3}}),(0,i.jsxs)(n.default,{sx:{mb:3},children:[(0,i.jsx)(d.default,{variant:"subtitle2",color:"text.secondary",sx:{mb:1},children:"Notes"}),(0,i.jsx)(d.default,{variant:"body2",children:N.notes})]})]}),N.packageDescription&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(x.A,{sx:{my:3}}),(0,i.jsxs)(n.default,{sx:{mb:3},children:[(0,i.jsx)(d.default,{variant:"subtitle2",color:"text.secondary",sx:{mb:1},children:"Package Description"}),(0,i.jsx)(d.default,{variant:"body2",children:N.packageDescription})]})]}),N.review&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(x.A,{sx:{my:3}}),(0,i.jsxs)(n.default,{sx:{mb:3},children:[(0,i.jsx)(d.default,{variant:"subtitle2",color:"text.secondary",sx:{mb:1},children:"Your Review"}),(0,i.jsxs)(d.default,{variant:"body2",sx:{mb:.5},children:["⭐ ",N.review.rating,"/5"]}),N.review.comment&&(0,i.jsx)(d.default,{variant:"body2",color:"text.secondary",children:N.review.comment})]})]})]}),(0,i.jsx)(n.default,{sx:{position:"absolute",bottom:56,left:0,right:0,p:2,backgroundColor:"background.paper",borderTop:1,borderColor:"divider"},children:(0,i.jsxs)(o.A,{spacing:1,children:[ee&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c.A,{severity:"info",sx:{mb:1},children:"You have been selected as the recipient. Please confirm or reject this delivery."}),(0,i.jsx)(b.$n,{variant:"contained",fullWidth:!0,onClick:J,disabled:q,children:q?"Confirming...":"Confirm Delivery"}),(0,i.jsx)(b.$n,{variant:"outlined",fullWidth:!0,onClick:Q,color:"error",disabled:q,children:q?"Rejecting...":"Reject Delivery"})]}),Z&&(null==N?void 0:N.recipientConfirmed)&&(null==N?void 0:N.status)===k.Re.PENDING&&(0,i.jsx)(c.A,{severity:"success",sx:{mb:1},children:"You have confirmed this delivery. Waiting for sender to proceed."}),(0,k.po)(N)&&(0,i.jsx)(b.$n,{variant:"contained",fullWidth:!0,onClick:X,children:"Contact Picker"}),(0,k.HX)(N)&&!ee&&(0,i.jsx)(b.$n,{variant:"outlined",fullWidth:!0,onClick:()=>{G(!0)},color:"error",children:"Cancel Order"}),(0,k.$2)(N)&&(0,i.jsx)(b.$n,{variant:"contained",fullWidth:!0,onClick:()=>{Y(!0)},children:"Leave Review"}),(N.status===k.Re.COMPLETED||N.status===k.Re.CANCELLED)&&(0,i.jsx)(b.$n,{variant:"outlined",fullWidth:!0,onClick:()=>{M.toast.success("Redirecting to create new order..."),setTimeout(()=>P.push("/delivery-methods"),1e3)},startIcon:(0,i.jsx)(m,{}),children:"Repeat Order"})]})})]})}),(0,i.jsx)(g.default,{}),(0,i.jsx)(E,{open:V,orderTrackingNumber:N.trackingNumber,onConfirm:()=>{R({...N,status:k.Re.CANCELLED,cancelledAt:new Date}),G(!1),M.toast.success("Order cancelled successfully"),setTimeout(()=>P.push("/orders"),1500)},onCancel:()=>G(!1)}),(0,i.jsx)(W,{open:_,pickerName:(null==(w=N.picker)?void 0:w.fullName)||"Picker",onSubmit:(e,t)=>{R({...N,review:{rating:e,comment:t,createdAt:new Date}}),Y(!1),M.toast.success("Review submitted successfully")},onCancel:()=>Y(!1)})]})}}},e=>{e.O(0,[3965,7225,3964,8202,6592,8534,7844,1101,5207,8652,8449,1190,7615,1986,2649,7212,1530,8421,8343,9267,8441,5964,7358],()=>e(e.s=16673)),_N_E=e.O()}]);