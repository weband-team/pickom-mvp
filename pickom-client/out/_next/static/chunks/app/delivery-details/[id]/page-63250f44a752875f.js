(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6509,6878,8780],{2295:(e,t,a)=>{Promise.resolve().then(a.bind(a,58517))},16509:(e,t,a)=>{"use strict";a.d(t,{TJ:()=>n,_z:()=>d,createChat:()=>r,iS:()=>c,m7:()=>s,ug:()=>l});var i=a(51070);let r=async e=>i.xh.post("/chat/create",e),l=async()=>i.xh.get("/chat"),s=async e=>i.xh.get("/chat/delivery/".concat(e)),n=async e=>i.xh.get("/chat/".concat(e)),d=async(e,t)=>i.xh.post("/chat/".concat(e,"/messages"),t),c=async e=>i.xh.patch("/chat/".concat(e,"/messages/mark-read"))},57773:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var i=a(31418),r=a(95155);let l=(0,i.A)((0,r.jsx)("path",{d:"m21.41 11.58-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58s1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41s-.23-1.06-.59-1.42M5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7"}),"LocalOffer")},58517:(e,t,a)=>{"use strict";a.d(t,{default:()=>H});var i=a(95155),r=a(12115),l=a(54581),s=a(14426),n=a(92302),d=a(3127),c=a(71116),o=a(41101),u=a(41218),h=a(16632),x=a(72705),f=a(68534),p=a(5716),j=a(78449),m=a(36114),v=a(54492),g=a(99927),y=a(71977),b=a(38464),C=a(52836),k=a(11335),A=a(63645),I=a(64341),w=a(21888),S=a(57773),W=a(74588),P=a(68558);let U=(0,a(31418).A)((0,i.jsx)("path",{d:"M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5zm-.5 1.5 1.96 2.5H17V9.5zM6 18c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1m2.22-3c-.55-.61-1.33-1-2.22-1s-1.67.39-2.22 1H3V6h12v9zM18 18c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1"}),"LocalShippingOutlined");var D=a(74802),z=a(69242),N=a(35695),F=a(43452),O=a(97704),V=a(21787),_=a(78780),M=a(6864),R=a(54670),E=a(70005),T=a(16509);function H(e){let{params:t}=e,a=(0,r.use)(t),H=(0,N.useRouter)(),[L,Y]=(0,r.useState)(null),[X,$]=(0,r.useState)(null),[q,B]=(0,r.useState)(null),[J,G]=(0,r.useState)(null),[K,Q]=(0,r.useState)(null),[Z,ee]=(0,r.useState)(null),[et,ea]=(0,r.useState)(!0),[ei,er]=(0,r.useState)(""),[el,es]=(0,r.useState)(!1),[en,ed]=(0,r.useState)(!1),[ec,eo]=(0,r.useState)(0),[eu,eh]=(0,r.useState)(""),[ex,ef]=(0,r.useState)(null),[ep,ej]=(0,r.useState)(!1),[em,ev]=(0,r.useState)(!1),[eg,ey]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{ea(!0),er("");try{let e=await (0,M.HW)();Q(e.user),ee(e.user.role);let t=(await (0,V.IT)(Number(a.id))).data;Y(t);try{let e=(await (0,M.wz)(t.senderId)).user;if(e){let t={uid:e.uid,fullName:e.name,avatarUrl:e.avatarUrl,rating:4.8,totalOrders:45,isPhoneVerified:!!e.phone,isEmailVerified:!0,memberSince:e.createdAt,phone:e.phone,email:e.email};$(t)}}catch(e){}if(t.pickerId)try{let e=(await (0,M.wz)(t.pickerId)).user;if(e){let t={uid:e.uid,fullName:e.name,avatarUrl:e.avatarUrl,rating:4.5,completedDeliveries:100,phone:e.phone};B(t)}}catch(e){}if(t.recipientId)try{let e=(await (0,M.wz)(String(t.recipientId))).user;if(e){let t={uid:e.uid,fullName:e.name,avatarUrl:e.avatarUrl,rating:e.rating||0,isPhoneVerified:!!e.phone,isEmailVerified:!0};G(t)}}catch(e){}}catch(e){er("Failed to load delivery details. Please try again.")}finally{ea(!1)}})()},[a.id]),(0,r.useEffect)(()=>{ef(document.querySelector("[data-mobile-container]"))},[]);let eb=async e=>{try{let{chatId:t}=(await (0,T.createChat)({participantId:e,deliveryId:null==L?void 0:L.id})).data;H.push("/chat/".concat(t))}catch(e){alert("Failed to open chat. Please try again.")}},eC=async()=>{if(J)try{let{chatId:e}=(await (0,T.createChat)({participantId:J.uid,deliveryId:null==L?void 0:L.id})).data;H.push("/chat/".concat(e))}catch(e){alert("Failed to open chat. Please try again.")}},ek=async()=>{if(L){es(!0);try{await (0,_.createOffer)({deliveryId:L.id,price:ec,message:eu||void 0}),alert("Offer submitted successfully!"),ed(!1),eo(0),eh("")}catch(e){alert("Failed to submit offer. Please try again.")}finally{es(!1)}}},eA=async()=>{if(L){es(!0);try{await (0,V.XE)(L.id,"cancelled"),alert("Delivery cancelled successfully"),ej(!1),H.push("/delivery-methods?tab=manage")}catch(e){alert("Failed to cancel delivery. Please try again.")}finally{es(!1)}}},eI=async e=>{ey(e),ev(!0)},ew=async()=>{if(L&&eg){es(!0);try{await (0,V.XE)(L.id,eg),Y({...L,status:eg}),alert("Status updated to ".concat("picked_up"===eg?"Picked Up":"Delivered","!")),ev(!1),ey(null),"delivered"===eg&&eW&&H.push("/rate-sender/".concat(L.id))}catch(e){alert("Failed to update status. Please try again.")}finally{es(!1)}}};if(et)return(0,i.jsx)(l.default,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"#f5f5f5"},children:(0,i.jsx)(s.default,{})});if(ei||!L)return(0,i.jsx)(l.default,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"#f5f5f5",p:2},children:(0,i.jsx)(n.A,{severity:"error",sx:{maxWidth:375},children:ei||"Delivery not found"})});let eS="sender"===Z,eW="picker"===Z,eP=eW&&L.pickerId===(null==K?void 0:K.uid);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(F.MobileContainer,{showFrame:!1,children:(0,i.jsxs)(l.default,{sx:{display:"flex",flexDirection:"column",height:"100vh",backgroundColor:"background.default"},children:[(0,i.jsxs)(l.default,{sx:{display:"flex",alignItems:"center",gap:1,p:2,borderBottom:1,borderColor:"divider"},children:[(0,i.jsx)(d.A,{onClick:()=>{"sender"===Z?H.push("/delivery-methods?tab=manage"):H.push("/available-deliveries")},size:"small",children:(0,i.jsx)(b.A,{})}),(0,i.jsxs)(c.default,{variant:"h6",sx:{fontWeight:600,flex:1},children:["Delivery #",L.id]}),(0,i.jsx)(o.A,{label:(e=>{switch(e){case"pending":return"Pending";case"accepted":return"Accepted";case"picked_up":return"Picked Up";case"delivered":return"Delivered";case"cancelled":return"Cancelled";default:return e}})(L.status),size:"small",color:(e=>{switch(e){case"pending":return"warning";case"accepted":return"info";case"picked_up":return"primary";case"delivered":return"success";case"cancelled":return"error";default:return"default"}})(L.status),sx:{fontWeight:600}})]}),(0,i.jsxs)(l.default,{sx:{flex:1,overflowY:"auto",pb:2},children:[(0,i.jsx)(u.A,{sx:{m:2,boxShadow:1},children:(0,i.jsxs)(h.A,{children:[(0,i.jsx)(c.default,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Route Details"}),(0,i.jsxs)(l.default,{sx:{display:"flex",alignItems:"flex-start",gap:1.5,mb:2},children:[(0,i.jsx)(C.A,{sx:{color:"success.main",mt:.5}}),(0,i.jsxs)(l.default,{children:[(0,i.jsx)(c.default,{variant:"caption",color:"text.secondary",children:"Pickup"}),(0,i.jsx)(c.default,{variant:"body2",sx:{fontWeight:500},children:L.fromAddress})]})]}),(0,i.jsxs)(l.default,{sx:{display:"flex",alignItems:"flex-start",gap:1.5,mb:2},children:[(0,i.jsx)(C.A,{sx:{color:"error.main",mt:.5}}),(0,i.jsxs)(l.default,{children:[(0,i.jsx)(c.default,{variant:"caption",color:"text.secondary",children:"Dropoff"}),(0,i.jsx)(c.default,{variant:"body2",sx:{fontWeight:500},children:L.toAddress})]})]}),L.packageDescription&&(0,i.jsxs)(l.default,{sx:{display:"flex",alignItems:"flex-start",gap:1.5,mb:2},children:[(0,i.jsx)(k.default,{sx:{color:"text.secondary",mt:.5}}),(0,i.jsxs)(l.default,{children:[(0,i.jsx)(c.default,{variant:"caption",color:"text.secondary",children:"Package"}),(0,i.jsx)(c.default,{variant:"body2",sx:{fontWeight:500},children:L.packageDescription})]})]}),(0,i.jsxs)(l.default,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:2,pt:2,borderTop:1,borderColor:"divider"},children:[(0,i.jsxs)(l.default,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,i.jsx)(A.A,{sx:{color:"primary.main"}}),(0,i.jsxs)(c.default,{variant:"h6",sx:{color:"primary.main",fontWeight:"bold"},children:[L.price," zł"]})]}),(0,i.jsxs)(l.default,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,i.jsx)(I.A,{sx:{fontSize:16,color:"text.secondary"}}),(0,i.jsx)(c.default,{variant:"caption",color:"text.secondary",children:new Date(L.createdAt).toLocaleDateString()})]})]})]})}),eS&&q&&(0,i.jsxs)(l.default,{sx:{m:2},children:[(0,i.jsx)(c.default,{variant:"subtitle1",sx:{fontWeight:600,mb:1},children:"Picker Information"}),(0,i.jsx)(u.A,{children:(0,i.jsx)(h.A,{children:(0,i.jsxs)(l.default,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,i.jsx)(l.default,{sx:{width:60,height:60,borderRadius:"50%",backgroundColor:"primary.light",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,i.jsx)(c.default,{variant:"h5",children:q.fullName[0]})}),(0,i.jsxs)(l.default,{sx:{flex:1},children:[(0,i.jsx)(c.default,{variant:"subtitle1",sx:{fontWeight:600},children:q.fullName}),(0,i.jsxs)(c.default,{variant:"body2",color:"text.secondary",children:["⭐ ",q.rating," • ",q.completedDeliveries," deliveries"]})]}),(0,i.jsx)(d.A,{onClick:()=>eb(q.uid),children:(0,i.jsx)(w.A,{})})]})})})]}),eW&&X&&(0,i.jsxs)(l.default,{sx:{m:2},children:[(0,i.jsx)(c.default,{variant:"subtitle1",sx:{fontWeight:600,mb:1},children:"Sender Information"}),(0,i.jsx)(R.A,{sender:X,variant:"full"})]}),eW&&(J||(null==L?void 0:L.recipientPhone))&&(0,i.jsxs)(l.default,{sx:{m:2},children:[(0,i.jsx)(c.default,{variant:"subtitle1",sx:{fontWeight:600,mb:1},children:"Receiver Information"}),(0,i.jsx)(E.A,{receiver:{recipientId:null==J?void 0:J.uid,recipientPhone:null==L?void 0:L.recipientPhone,recipientUser:J?{uid:J.uid,fullName:J.fullName,avatarUrl:J.avatarUrl,rating:J.rating,isPhoneVerified:J.isPhoneVerified,isEmailVerified:J.isEmailVerified}:void 0},onContactClick:J?eC:void 0,variant:"compact"})]})]}),(0,i.jsx)(l.default,{sx:{p:2,backgroundColor:"background.paper",borderTop:1,borderColor:"divider",boxShadow:"0 -2px 8px rgba(0,0,0,0.1)",pb:8},children:(0,i.jsxs)(x.A,{spacing:1.5,children:[eS&&"pending"===L.status&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(f.A,{variant:"outlined",onClick:()=>H.push("/delivery-methods/".concat(L.id,"/offers")),fullWidth:!0,startIcon:(0,i.jsx)(S.A,{}),children:"View Offers"}),(0,i.jsx)(f.A,{variant:"outlined",color:"error",onClick:()=>ej(!0),fullWidth:!0,startIcon:(0,i.jsx)(W.A,{}),children:"Cancel Delivery"})]}),eS&&("accepted"===L.status||"picked_up"===L.status)&&q&&(0,i.jsx)(f.A,{variant:"outlined",onClick:()=>eb(q.uid),fullWidth:!0,startIcon:(0,i.jsx)(w.A,{}),children:"Chat with Picker"}),eS&&"delivered"===L.status&&q&&(0,i.jsx)(f.A,{variant:"contained",color:"primary",onClick:()=>H.push("/rate-picker/".concat(L.id)),fullWidth:!0,startIcon:(0,i.jsx)(P.default,{}),children:"Rate Picker"}),eW&&!eP&&"pending"===L.status&&(0,i.jsxs)(i.Fragment,{children:[X&&(0,i.jsx)(f.A,{variant:"outlined",onClick:()=>eb(X.uid),fullWidth:!0,startIcon:(0,i.jsx)(w.A,{}),children:"Chat with Sender"}),(0,i.jsx)(f.A,{variant:"outlined",color:"secondary",onClick:()=>{eo((null==L?void 0:L.price)||0),ed(!0)},fullWidth:!0,startIcon:(0,i.jsx)(S.A,{}),children:"Make an Offer"})]}),eP&&"accepted"===L.status&&(0,i.jsxs)(i.Fragment,{children:[X&&(0,i.jsx)(f.A,{variant:"outlined",onClick:()=>eb(X.uid),fullWidth:!0,startIcon:(0,i.jsx)(w.A,{}),children:"Chat with Sender"}),(0,i.jsx)(f.A,{variant:"contained",color:"primary",onClick:()=>eI("picked_up"),fullWidth:!0,startIcon:(0,i.jsx)(U,{}),children:"Mark as Picked Up"})]}),eP&&"picked_up"===L.status&&(0,i.jsxs)(i.Fragment,{children:[X&&(0,i.jsx)(f.A,{variant:"outlined",onClick:()=>eb(X.uid),fullWidth:!0,startIcon:(0,i.jsx)(w.A,{}),children:"Chat with Sender"}),(0,i.jsx)(f.A,{variant:"contained",color:"success",onClick:()=>eI("delivered"),fullWidth:!0,startIcon:(0,i.jsx)(D.default,{}),children:"Mark as Delivered"})]})]})})]})}),(0,i.jsx)(O.default,{}),(0,i.jsxs)(p.A,{anchor:"bottom",open:en,onClose:()=>!el&&ed(!1),onOpen:()=>{},disableSwipeToOpen:!0,disablePortal:!0,container:ex,ModalProps:{keepMounted:!1},PaperProps:{sx:{maxHeight:"90vh",maxWidth:"375px",margin:"0 auto",borderTopLeftRadius:16,borderTopRightRadius:16,backgroundColor:"background.paper"}},children:[(0,i.jsx)(()=>(0,i.jsx)(l.default,{sx:{width:40,height:4,backgroundColor:"action.disabled",borderRadius:2,position:"absolute",top:8,left:"calc(50% - 20px)"}}),{}),(0,i.jsxs)(l.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:3,pt:3,pb:1},children:[(0,i.jsx)(c.default,{variant:"h6",sx:{fontWeight:600},children:"Make an Offer"}),(0,i.jsx)(d.A,{onClick:()=>ed(!1),size:"small",disabled:el,children:(0,i.jsx)(z.A,{})})]}),(0,i.jsx)(l.default,{sx:{px:3,pb:2,overflowY:"auto"},children:(0,i.jsxs)(l.default,{sx:{pt:1},children:[(0,i.jsxs)(c.default,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Current price: ",(0,i.jsxs)("strong",{children:[L.price," zł"]})]}),(0,i.jsx)(j.default,{label:"Your Price (zł)",type:"number",fullWidth:!0,value:ec,onChange:e=>eo(Number(e.target.value)),sx:{mb:2},inputProps:{min:0,step:.01},disabled:el}),(0,i.jsx)(j.default,{label:"Message (optional)",multiline:!0,rows:3,fullWidth:!0,value:eu,onChange:e=>eh(e.target.value),placeholder:"Add a message to the sender...",disabled:el})]})}),(0,i.jsxs)(l.default,{sx:{px:3,py:2,borderTop:1,borderColor:"divider",display:"flex",gap:2},children:[(0,i.jsx)(f.A,{onClick:()=>ed(!1),disabled:el,variant:"outlined",fullWidth:!0,children:"Cancel"}),(0,i.jsx)(f.A,{onClick:ek,variant:"contained",disabled:el||ec<=0,fullWidth:!0,children:el?"Submitting...":"Submit Offer"})]})]}),(0,i.jsxs)(m.A,{open:ep,onClose:()=>!el&&ej(!1),maxWidth:"xs",fullWidth:!0,children:[(0,i.jsx)(v.A,{children:"Cancel Delivery?"}),(0,i.jsx)(g.A,{children:(0,i.jsxs)(c.default,{variant:"body2",children:["Are you sure you want to cancel delivery #",L.id,"?"]})}),(0,i.jsxs)(y.A,{children:[(0,i.jsx)(f.A,{onClick:()=>ej(!1),disabled:el,children:"No"}),(0,i.jsx)(f.A,{onClick:eA,variant:"contained",color:"error",disabled:el,children:el?"Cancelling...":"Yes, Cancel"})]})]}),(0,i.jsxs)(m.A,{open:em,onClose:()=>!el&&ev(!1),maxWidth:"xs",fullWidth:!0,children:[(0,i.jsx)(v.A,{children:"Update Status?"}),(0,i.jsx)(g.A,{children:(0,i.jsxs)(c.default,{variant:"body2",children:["Mark delivery as ","picked_up"===eg?"Picked Up":"Delivered","?"]})}),(0,i.jsxs)(y.A,{children:[(0,i.jsx)(f.A,{onClick:()=>{ev(!1),ey(null)},disabled:el,children:"Cancel"}),(0,i.jsx)(f.A,{onClick:ew,variant:"contained",color:"delivered"===eg?"success":"primary",disabled:el,children:el?"Updating...":"Confirm"})]})]})]})}},70005:(e,t,a)=>{"use strict";a.d(t,{A:()=>u});var i=a(95155),r=a(54581),l=a(72705),s=a(42663),n=a(71116),d=a(37429),c=a(26290),o=a(58343);function u(e){let{receiver:t,onContactClick:a,variant:u="compact"}=e;if(t.recipientId&&t.recipientUser){let e=t.recipientUser.isPhoneVerified&&t.recipientUser.isEmailVerified;return(0,i.jsxs)(r.default,{sx:{p:2,borderRadius:2,backgroundColor:"background.paper",border:1,borderColor:"divider"},children:[(0,i.jsxs)(l.A,{direction:"row",spacing:2,alignItems:"flex-start",children:[(0,i.jsx)(s.default,{src:t.recipientUser.avatarUrl,sx:{width:"full"===u?64:48,height:"full"===u?64:48,bgcolor:"success.main",fontSize:"full"===u?"1.5rem":"1.2rem"},children:t.recipientUser.fullName.charAt(0).toUpperCase()}),(0,i.jsxs)(r.default,{sx:{flex:1},children:[(0,i.jsxs)(r.default,{sx:{display:"flex",alignItems:"center",gap:.5,mb:.5},children:[(0,i.jsx)(n.default,{variant:"full"===u?"h6":"subtitle2",sx:{fontWeight:600},children:t.recipientUser.fullName}),e&&(0,i.jsx)(d.A,{sx:{fontSize:18,color:"success.main"}})]}),(0,i.jsxs)(n.default,{variant:"body2",color:"text.secondary",children:["⭐ ","number"==typeof t.recipientUser.rating?t.recipientUser.rating.toFixed(1):"0.0"]})]})]}),a&&(0,i.jsx)(o.$n,{variant:"contained",fullWidth:!0,onClick:a,sx:{mt:2},children:"Contact Receiver"})]})}return t.recipientPhone?(0,i.jsxs)(r.default,{sx:{p:2,borderRadius:2,backgroundColor:"background.paper",border:1,borderColor:"divider"},children:[(0,i.jsxs)(l.A,{direction:"row",spacing:2,alignItems:"center",children:[(0,i.jsx)(c.default,{sx:{color:"text.secondary",fontSize:24}}),(0,i.jsxs)(r.default,{sx:{flex:1},children:[(0,i.jsx)(n.default,{variant:"caption",color:"text.secondary",children:"Receiver Phone"}),(0,i.jsx)(n.default,{variant:"body1",sx:{fontWeight:600},children:t.recipientPhone})]})]}),(0,i.jsx)(o.$n,{variant:"contained",fullWidth:!0,onClick:()=>window.open("tel:".concat(t.recipientPhone)),sx:{mt:2},startIcon:(0,i.jsx)(c.default,{}),children:"Call"})]}):null}},78780:(e,t,a)=>{"use strict";a.d(t,{F8:()=>l,aT:()=>n,createOffer:()=>r,i6:()=>s});var i=a(51070);let r=async e=>i.xh.post("/offers",e),l=async e=>i.xh.get("/offers/delivery/".concat(e)),s=async(e,t)=>i.xh.patch("/offers/".concat(e),t),n=async()=>i.xh.get("/offers/my")}},e=>{e.O(0,[3965,7225,9313,1623,3806,8534,1101,5207,8449,1190,9283,1986,7262,2649,7212,5394,1274,8343,6233,8441,5964,7358],()=>e(e.s=2295)),_N_E=e.O()}]);