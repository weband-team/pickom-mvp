(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3614],{6864:(e,t,a)=>{"use strict";a.d(t,{$H:()=>i,HW:()=>n,TK:()=>s,op:()=>l,wz:()=>o});var r=a(51070);let o=async e=>(await r.xh.get("/user/".concat(e))).data,s=async(e,t)=>(await r.xh.put("/user/".concat(e),t)).data,n=async()=>(await r.xh.get("/auth/me")).data,i=async(e,t)=>(await r.xh.put("/user/".concat(e,"/online-status"),{isOnline:t})).data,l=async e=>(await r.xh.get("/user/".concat(e,"/balance"))).data},14140:(e,t,a)=>{"use strict";a.d(t,{j:()=>n});var r=a(23915),o=a(45404);let s=(0,r.Wp)({apiKey:"AIzaSyDiclg8XNo2L1hDBoaSoHmFMBggUKYjHH4",authDomain:"pickom-mvp.firebaseapp.com",projectId:"pickom-mvp",storageBucket:"pickom-mvp.firebasestorage.app",messagingSenderId:"168767828055",appId:"1:168767828055:web:2853961b44970c114ab312"}),n=(0,o.xI)(s)},28069:(e,t,a)=>{"use strict";a.d(t,{Nq:()=>l,c4:()=>s,mH:()=>i,mg:()=>n,vx:()=>d});var r=a(51070),o=a(14140);let s=async()=>{let e=o.j.currentUser;return e?await e.getIdToken():null},n=async e=>r.Bb.post("/auth/login",{},{headers:{Authorization:"Bearer ".concat(e)}}),i=async(e,t,a,o)=>r.Bb.post("/auth/register",{role:e,phone:a,name:o},{headers:{Authorization:"Bearer ".concat(t)}}),l=async()=>r.xh.get("/auth/me"),d=async()=>r.xh.post("/auth/logout")},43452:(e,t,a)=>{"use strict";a.d(t,{MobileContainer:()=>i});var r=a(95155);a(12115);var o=a(54581),s=a(18407),n=a(35695);let i=e=>{let{children:t,width:a=375,height:i=812,showFrame:l=!0,backgroundColor:d,showBottomNav:c=!0}=e,u=(0,n.usePathname)(),h=(null==u?void 0:u.includes("/login"))||(null==u?void 0:u.includes("/register")),p=c&&!h;return l?(0,r.jsx)(o.default,{sx:{display:"flex",justifyContent:"center",alignItems:"center",padding:3,backgroundColor:"#f5f5f5"},children:(0,r.jsx)(s.A,{elevation:3,sx:{width:a,height:p?"calc(".concat(i,"px - 70px)"):i,borderRadius:6,overflow:"hidden",position:"relative",bgcolor:d||"background.default",border:"8px solid #000000","&::before":{content:'""',position:"absolute",top:12,left:"50%",transform:"translateX(-50%)",width:134,height:6,backgroundColor:"#000000",borderRadius:3,zIndex:1},"&::after":{content:'""',position:"absolute",bottom:8,left:"50%",transform:"translateX(-50%)",width:134,height:5,backgroundColor:"#000000",borderRadius:2.5,zIndex:1}},children:(0,r.jsx)(o.default,{"data-mobile-container":!0,sx:{width:"100%",height:"100%",paddingTop:"calc(24px + var(--safe-area-top))",overflow:"auto",position:"relative","&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none"},children:(0,r.jsx)(o.default,{sx:{paddingBottom:"calc(16px + var(--safe-area-bottom))",minHeight:"100%"},children:t})})})}):(0,r.jsx)(o.default,{"data-mobile-container":!0,sx:{width:"100vw",height:"100vh",bgcolor:d||"background.default",overflow:"hidden",position:"fixed",left:0,right:0,bottom:0,pt:"env(safe-area-inset-top)",pb:p?"68px":0,margin:0,"&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none"},children:(0,r.jsx)(o.default,{sx:{width:"100%",height:"100%",overflow:"auto",margin:0,padding:0,"&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none"},children:t})})}},51070:(e,t,a)=>{"use strict";a.d(t,{Bb:()=>d,xh:()=>l,y3:()=>c});var r=a(23464),o=a(14140),s=a(6267),n=a(87358);let i=s.Ii.isNativePlatform()?"https://pickom.qirelab.com":n.env.NEXT_PUBLIC_API_URL||"https://pickom.qirelab.com",l=r.A.create({baseURL:i,withCredentials:!0,timeout:3e4,headers:{"Content-Type":"application/json"}});l.interceptors.request.use(async e=>{let t=o.j.currentUser;if(t)try{let a=await t.getIdToken();e.headers.Authorization="Bearer ".concat(a)}catch(e){}return e},e=>Promise.reject(e)),l.interceptors.response.use(e=>e,e=>Promise.reject(e));let d=r.A.create({baseURL:i,withCredentials:!0,timeout:3e4,headers:{"Content-Type":"application/json"}});async function c(){try{return await r.A.get("".concat(i,"/api"),{timeout:5e3}),!0}catch(e){return!1}}d.interceptors.response.use(e=>e,e=>Promise.reject(e))},86033:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>I});var r=a(95155),o=a(54581),s=a(14426),n=a(92302),i=a(68534),l=a(71116),d=a(41218),c=a(16632),u=a(78449),h=a(36114),p=a(54492),x=a(99927),f=a(74964),m=a(71977),b=a(38464),g=a(72093),j=a(40857),y=a(35695),v=a(12115),C=a(23464),w=a(31530),k=a(43452),A=a(97704),S=a(28069),W=a(6864),P=a(77560);function I(){let e=(0,y.useRouter)(),[t,a]=(0,v.useState)(null),[I,B]=(0,v.useState)(0),[F,T]=(0,v.useState)("10"),[R,M]=(0,v.useState)("Balance top-up"),[N,U]=(0,v.useState)(!0),[q,z]=(0,v.useState)(!1),[H,_]=(0,v.useState)(""),[D,E]=(0,v.useState)(""),[L,$]=(0,v.useState)(!1),[X,K]=(0,v.useState)(!1);(0,v.useEffect)(()=>{(async()=>{try{let e=(await (0,S.Nq)()).data.user;a(e);let t=await (0,W.op)(e.uid);B(t.balance||0)}catch(t){_("Failed to load data. Please login again."),setTimeout(()=>e.push("/login"),2e3)}finally{U(!1)}})()},[e]);let O=e=>{let t=parseFloat(e);return isNaN(t)?(E("Please enter a valid number"),!1):t<1?(E("Minimum amount is $1"),!1):t>1e3?(E("Maximum amount is $1000"),!1):(E(""),!0)},Y=async e=>{e.preventDefault(),t&&O(F)&&$(!0)},G=async()=>{if(t&&O(F)){$(!1),z(!0);try{let{url:e}=(await C.A.post("".concat("https://pickom.qirelab.com","/payment/topup-balance"),{amount:parseFloat(F),description:R},{withCredentials:!0})).data;w.default.success("Redirecting to payment page..."),window.location.href=e}catch(o){let t="Unknown error occurred";if(o&&"object"==typeof o&&"response"in o){var e,a,r;t=(null==(a=o.response)||null==(e=a.data)?void 0:e.message)||"Server error: ".concat(null==(r=o.response)?void 0:r.status)}else o instanceof Error&&(t=o.message);w.default.error("Top-up failed: ".concat(t)),z(!1)}}},J=async e=>{if(t&&O(F)){K(!1),$(!1),z(!0);try{let{status:a}=(await C.A.post("".concat("https://pickom.qirelab.com","/payment/topup-balance"),{amount:parseFloat(F),description:R,paymentMethodId:e},{withCredentials:!0})).data;if("succeeded"===a){w.default.success("Payment successful! Balance updated.");let e=await (0,W.op)(t.uid);B(e.balance||0),T("10"),M("Balance top-up")}else"requires_action"===a?w.default.error("3D Secure authentication required. Please use Stripe Checkout instead."):w.default.error("Payment processing. Check your balance in a moment.");z(!1)}catch(t){let e="Unknown error occurred";if(t&&"object"==typeof t&&"response"in t){var a,r,o;e=(null==(r=t.response)||null==(a=r.data)?void 0:a.message)||"Server error: ".concat(null==(o=t.response)?void 0:o.status)}else t instanceof Error&&(e=t.message);w.default.error("Payment failed: ".concat(e)),z(!1)}}};return N?(0,r.jsx)(o.default,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh"},children:(0,r.jsx)(s.default,{})}):H||!t?(0,r.jsx)(o.default,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",p:2},children:(0,r.jsx)(n.A,{severity:"error",children:H||"Failed to load data"})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(k.MobileContainer,{showFrame:!1,children:(0,r.jsxs)(o.default,{sx:{p:3,pb:10,backgroundColor:"background.default",minHeight:"100vh"},children:[(0,r.jsxs)(o.default,{sx:{mb:3,display:"flex",alignItems:"center"},children:[(0,r.jsx)(i.A,{onClick:()=>{e.back()},sx:{minWidth:"auto",p:1,mr:1},children:(0,r.jsx)(b.A,{})}),(0,r.jsx)(l.default,{variant:"h5",sx:{fontWeight:600},children:"Top Up Balance"})]}),(0,r.jsx)(d.A,{sx:{mb:3},children:(0,r.jsxs)(c.A,{children:[(0,r.jsx)(l.default,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Current Balance"}),(0,r.jsxs)(l.default,{variant:"h4",sx:{fontWeight:700,color:"#667eea"},children:["$",I.toFixed(2)]})]})}),(0,r.jsxs)("form",{onSubmit:Y,children:[(0,r.jsx)(o.default,{sx:{mb:3},children:(0,r.jsx)(u.default,{fullWidth:!0,label:"Amount (USD)",type:"number",value:F,onChange:e=>{let t=e.target.value;T(t),t&&O(t)},error:!!D,helperText:D||"Minimum: $1, Maximum: $1000",inputProps:{min:1,max:1e3,step:.01},required:!0})}),(0,r.jsx)(o.default,{sx:{mb:3},children:(0,r.jsx)(u.default,{fullWidth:!0,label:"Description (optional)",value:R,onChange:e=>M(e.target.value),multiline:!0,rows:2})}),(0,r.jsx)(i.A,{fullWidth:!0,variant:"contained",type:"submit",disabled:q||!!D,sx:{py:1.5,fontSize:"1rem",fontWeight:600,textTransform:"none"},children:q?(0,r.jsx)(s.default,{size:24}):"Continue to Payment"})]})]})}),(0,r.jsx)(A.default,{}),(0,r.jsxs)(h.A,{open:L,onClose:()=>$(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[(0,r.jsx)(p.A,{children:"Select Payment Method"}),(0,r.jsx)(x.A,{children:(0,r.jsxs)(o.default,{sx:{pt:1},children:[(0,r.jsxs)(l.default,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Choose how you want to pay for this top-up of $",parseFloat(F).toFixed(2)]}),(0,r.jsxs)(o.default,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,r.jsx)(i.A,{variant:"outlined",startIcon:(0,r.jsx)(g.default,{}),onClick:()=>K(!0),fullWidth:!0,sx:{py:1.5,justifyContent:"flex-start",textTransform:"none"},children:"Pay with Saved Card"}),(0,r.jsx)(i.A,{variant:"outlined",startIcon:(0,r.jsx)(j.A,{}),onClick:G,fullWidth:!0,sx:{py:1.5,justifyContent:"flex-start",textTransform:"none"},children:"Pay with New Card (Stripe Checkout)"})]}),(0,r.jsx)(f.A,{sx:{my:2}}),(0,r.jsx)(l.default,{variant:"caption",color:"text.secondary",children:"All payments are securely processed by Stripe"})]})}),(0,r.jsx)(m.A,{children:(0,r.jsx)(i.A,{onClick:()=>$(!1),color:"inherit",children:"Cancel"})})]}),(0,r.jsx)(P.A,{open:X,onClose:()=>K(!1),onCardSelected:J,title:"Select Card for Top-Up"})]})}},92953:(e,t,a)=>{Promise.resolve().then(a.bind(a,86033))},97704:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>f});var r=a(95155),o=a(12115),s=a(35695),n=a(18407),i=a(40541),l=a(9111),d=a(26564),c=a(11335),u=a(21888),h=a(43290),p=a(60807);let x=e=>e>99?"99+":e,f=(0,o.memo)(function(){let{className:e,unreadChatsCount:t=0,activeOrdersCount:a=0,unreadNotificationsCount:f=0,userRole:m}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=(0,s.useRouter)(),g=(0,s.usePathname)(),[j,y]=(0,o.useState)(()=>localStorage.getItem("userRole"));(0,o.useEffect)(()=>{if(!m){let e=null;g.startsWith("/available-deliveries")?e="picker":g.startsWith("/delivery-methods")&&(e="sender"),e&&e!==j&&(y(e),localStorage.setItem("userRole",e))}},[g,m,j]);let v=m||j,C=(0,o.useMemo)(()=>g.startsWith("/delivery-methods")||g.startsWith("/orders")||g.startsWith("/available-deliveries")?0:g.startsWith("/chat")?1:g.startsWith("/notifications")?2:3*!!g.startsWith("/profile"),[g]),[w,k]=(0,o.useState)(C),A=(0,o.useCallback)((e,t)=>{switch(k(t),t){case 0:"picker"===v?b.push("/available-deliveries"):b.push("/delivery-methods");break;case 1:b.push("/chats");break;case 2:b.push("/notifications");break;case 3:b.push("/profile")}},[b,v]);return(0,r.jsx)(n.A,{className:e,sx:{position:"fixed",bottom:0,left:0,right:0,width:"100vw",zIndex:1200,paddingBottom:"env(safe-area-inset-bottom)",paddingLeft:0,paddingRight:0,backgroundColor:"background.paper",borderTop:1,borderColor:"divider",borderRadius:0,boxShadow:"0px -2px 4px rgba(0, 0, 0, 0.1)"},elevation:0,children:(0,r.jsxs)(i.A,{value:w,onChange:A,sx:{backgroundColor:"background.paper",width:"100%",height:"68px",paddingLeft:"env(safe-area-inset-left)",paddingRight:"env(safe-area-inset-right)"},children:[(0,r.jsx)(l.A,{label:"Orders",icon:(0,r.jsx)(d.default,{badgeContent:x(a),color:"error",max:99,sx:{"& .MuiBadge-badge":{backgroundColor:"#FF9500",color:"#000000",fontWeight:600}},children:(0,r.jsx)(c.default,{})})}),(0,r.jsx)(l.A,{label:"Chat",icon:(0,r.jsx)(d.default,{badgeContent:x(t),color:"error",max:99,sx:{"& .MuiBadge-badge":{backgroundColor:"#FF9500",color:"#000000",fontWeight:600}},children:(0,r.jsx)(u.A,{})})}),(0,r.jsx)(l.A,{label:"Notifications",icon:(0,r.jsx)(d.default,{badgeContent:x(f),color:"error",max:99,sx:{"& .MuiBadge-badge":{backgroundColor:"#FF9500",color:"#000000",fontWeight:600}},children:(0,r.jsx)(h.A,{})})}),(0,r.jsx)(l.A,{label:"Profile",icon:(0,r.jsx)(p.default,{})})]})})})}},e=>{e.O(0,[3965,7225,3964,8202,6592,8534,7844,1101,5207,8652,8449,5394,1530,507,6990,7560,8441,5964,7358],()=>e(e.s=92953)),_N_E=e.O()}]);