(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6509,8076],{6864:(e,t,a)=>{"use strict";a.d(t,{$H:()=>o,HW:()=>n,TK:()=>i,op:()=>c,wz:()=>r});var s=a(51070);let r=async e=>(await s.xh.get("/user/".concat(e))).data,i=async(e,t)=>(await s.xh.put("/user/".concat(e),t)).data,n=async()=>(await s.xh.get("/auth/me")).data,o=async(e,t)=>(await s.xh.put("/user/".concat(e,"/online-status"),{isOnline:t})).data,c=async e=>(await s.xh.get("/user/".concat(e,"/balance"))).data},14140:(e,t,a)=>{"use strict";a.d(t,{j:()=>n});var s=a(23915),r=a(45404);let i=(0,s.Wp)({apiKey:"AIzaSyDiclg8XNo2L1hDBoaSoHmFMBggUKYjHH4",authDomain:"pickom-mvp.firebaseapp.com",projectId:"pickom-mvp",storageBucket:"pickom-mvp.firebasestorage.app",messagingSenderId:"168767828055",appId:"1:168767828055:web:2853961b44970c114ab312"}),n=(0,r.xI)(i)},16509:(e,t,a)=>{"use strict";a.d(t,{TJ:()=>o,_z:()=>c,createChat:()=>r,iS:()=>l,m7:()=>n,ug:()=>i});var s=a(51070);let r=async e=>s.xh.post("/chat/create",e),i=async()=>s.xh.get("/chat"),n=async e=>s.xh.get("/chat/delivery/".concat(e)),o=async e=>s.xh.get("/chat/".concat(e)),c=async(e,t)=>s.xh.post("/chat/".concat(e,"/messages"),t),l=async e=>s.xh.patch("/chat/".concat(e,"/messages/mark-read"))},20250:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var s=a(31418),r=a(95155);let i=(0,s.A)((0,r.jsx)("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp")},21717:(e,t,a)=>{"use strict";a.d(t,{n:()=>r});var s=a(51070);let r={getUserNotifications:async()=>(await s.xh.get("/notifications")).data,getUnreadCount:async()=>(await s.xh.get("/notifications/unread-count")).data.count,markAsRead:async e=>(await s.xh.patch("/notifications/".concat(e,"/read"))).data,markAllAsRead:async()=>{await s.xh.patch("/notifications/mark-all-read")},notifyOfferReceived:async e=>(await s.xh.post("/notifications/offer-received",e)).data,notifyOfferAccepted:async e=>(await s.xh.post("/notifications/offer-accepted",e)).data,notifyIncomingDelivery:async e=>(await s.xh.post("/notifications/incoming-delivery",e)).data,notifyStatusUpdate:async e=>(await s.xh.post("/notifications/status-update",e)).data,createNotification:async e=>(await s.xh.post("/notifications/create",e)).data}},21787:(e,t,a)=>{"use strict";a.d(t,{IT:()=>o,S1:()=>h,TS:()=>f,XE:()=>c,confirmRecipient:()=>u,createDeliveryRequest:()=>i,qM:()=>d,rg:()=>x,updateDeliveryRequest:()=>l,vd:()=>r,zW:()=>n});var s=a(51070);let r=async()=>s.Bb.get("/delivery/pickers"),i=async e=>s.xh.post("/delivery/requests",e),n=async()=>s.xh.get("/delivery/requests"),o=async e=>s.xh.get("/delivery/requests/".concat(e)),c=async(e,t)=>s.xh.put("/delivery/requests/".concat(e,"/status"),{status:t}),l=async(e,t)=>s.xh.patch("/delivery/requests/".concat(e),t),d=async()=>s.xh.get("/delivery/completed"),h=async()=>s.xh.get("/delivery/cancelled"),u=async(e,t)=>s.xh.put("/delivery/requests/".concat(e,"/confirm-recipient"),{confirmed:t}),x=async e=>s.xh.post("/delivery/find-receiver",{email:e}),f=async()=>s.xh.get("/delivery/incoming")},22122:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var s=a(31418),r=a(95155);let i=(0,s.A)((0,r.jsx)("path",{d:"M21 18v1c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2V5c0-1.1.89-2 2-2h14c1.1 0 2 .9 2 2v1h-9c-1.11 0-2 .9-2 2v8c0 1.1.89 2 2 2zm-9-2h10V8H12zm4-2.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5"}),"AccountBalanceWallet")},22845:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>k});var s=a(95155),r=a(54581),i=a(14426),n=a(92302),o=a(68534),c=a(71116),l=a(41218),d=a(16632),h=a(38464),u=a(22122),x=a(20250),f=a(74588),p=a(35695),g=a(12115),b=a(43452),m=a(97704),v=a(28069),y=a(6864),j=a(21787),w=a(27604);function k(){let e=(0,p.useRouter)(),{unreadChats:t,unreadNotifications:a}=(0,w.K)(),[k,C]=(0,g.useState)(null),[A,I]=(0,g.useState)(0),[S,W]=(0,g.useState)(0),[B,R]=(0,g.useState)(0),[z,H]=(0,g.useState)(0),[N,F]=(0,g.useState)(!0),[M,T]=(0,g.useState)("");return((0,g.useEffect)(()=>{(async()=>{try{let e=(await (0,v.Nq)()).data.user;C(e);let t=await (0,y.op)(e.uid);I(Number(t.balance)||0);let[a,s]=await Promise.all([(0,j.qM)(),(0,j.S1)()]),r=a.data||[],i=s.data||[];if(W(r.length),H(i.length),"picker"===e.role){let e=r.reduce((e,t)=>e+(Number(t.price)||0),0);R(Number(e)||0)}}catch(t){T("Failed to load earnings. Please login again."),setTimeout(()=>e.push("/login"),2e3)}finally{F(!1)}})()},[e]),N)?(0,s.jsx)(r.default,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh"},children:(0,s.jsx)(i.default,{})}):M||!k?(0,s.jsx)(r.default,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",p:2},children:(0,s.jsx)(n.A,{severity:"error",children:M||"Failed to load earnings"})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(b.MobileContainer,{showFrame:!1,children:(0,s.jsxs)(r.default,{sx:{p:3,pb:10,backgroundColor:"background.default",minHeight:"100vh"},children:[(0,s.jsxs)(r.default,{sx:{mb:3,display:"flex",alignItems:"center"},children:[(0,s.jsx)(o.A,{onClick:()=>{e.back()},sx:{minWidth:"auto",p:1,mr:1},children:(0,s.jsx)(h.A,{})}),(0,s.jsx)(c.default,{variant:"h5",sx:{fontWeight:600},children:"picker"===k.role?"My Earnings":"My Balance"})]}),(0,s.jsx)(l.A,{sx:{mb:3,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},children:(0,s.jsxs)(d.A,{children:[(0,s.jsxs)(r.default,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,s.jsx)(u.A,{sx:{color:"white",mr:1}}),(0,s.jsx)(c.default,{variant:"body2",sx:{color:"rgba(255,255,255,0.9)"},children:"Current Balance"})]}),(0,s.jsxs)(c.default,{variant:"h3",sx:{color:"white",fontWeight:700,mb:2},children:["$",A.toFixed(2)]}),(0,s.jsx)(o.A,{fullWidth:!0,variant:"contained",onClick:()=>{e.push("/earnings/top-up")},sx:{backgroundColor:"white",color:"#667eea","&:hover":{backgroundColor:"rgba(255,255,255,0.9)"}},children:"Top Up Balance"})]})}),(0,s.jsx)(c.default,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Statistics"}),(0,s.jsx)(l.A,{sx:{mb:2},children:(0,s.jsx)(d.A,{children:(0,s.jsxs)(r.default,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,s.jsxs)(r.default,{sx:{display:"flex",alignItems:"center"},children:[(0,s.jsx)(x.A,{sx:{color:"#4caf50",mr:1}}),(0,s.jsxs)(r.default,{children:[(0,s.jsx)(c.default,{variant:"body2",color:"text.secondary",children:"picker"===k.role?"Completed Deliveries":"Completed Orders"}),(0,s.jsx)(c.default,{variant:"h6",sx:{fontWeight:600},children:S})]})]}),(0,s.jsx)(o.A,{variant:"text",onClick:()=>{e.push("/earnings/completed")},children:"View"})]})})}),"picker"===k.role&&(0,s.jsx)(l.A,{sx:{mb:2},children:(0,s.jsxs)(d.A,{children:[(0,s.jsxs)(r.default,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,s.jsx)(u.A,{sx:{color:"#2196f3",mr:1}}),(0,s.jsx)(c.default,{variant:"body2",color:"text.secondary",children:"Total Earnings"})]}),(0,s.jsxs)(c.default,{variant:"h5",sx:{fontWeight:600,color:"#2196f3"},children:["$",B.toFixed(2)]})]})}),(0,s.jsx)(l.A,{children:(0,s.jsx)(d.A,{children:(0,s.jsxs)(r.default,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,s.jsxs)(r.default,{sx:{display:"flex",alignItems:"center"},children:[(0,s.jsx)(f.A,{sx:{color:"#f44336",mr:1}}),(0,s.jsxs)(r.default,{children:[(0,s.jsx)(c.default,{variant:"body2",color:"text.secondary",children:"picker"===k.role?"Cancelled Deliveries":"Cancelled Orders"}),(0,s.jsx)(c.default,{variant:"h6",sx:{fontWeight:600},children:z})]})]}),(0,s.jsx)(o.A,{variant:"text",onClick:()=>{e.push("/earnings/cancelled")},children:"View"})]})})})]})}),(0,s.jsx)(m.default,{unreadChatsCount:t,unreadNotificationsCount:a})]})}},27604:(e,t,a)=>{"use strict";a.d(t,{K:()=>n});var s=a(12115),r=a(21717),i=a(16509);function n(){let[e,t]=(0,s.useState)(0),[a,n]=(0,s.useState)(0),[o,c]=(0,s.useState)(0),[l,d]=(0,s.useState)(!0),h=(0,s.useCallback)(async()=>{try{let[e,a]=await Promise.all([(0,i.ug)().catch(()=>({data:[]})),r.n.getUnreadCount().catch(()=>0)]),s=e.data.reduce((e,t)=>e+(t.unreadCount||0),0);t(s),n(a),c(0)}catch(e){console.error("Failed to fetch navigation badge counts:",e)}finally{d(!1)}},[]);return(0,s.useEffect)(()=>{h()},[h]),(0,s.useEffect)(()=>{let e=setInterval(h,3e4);return()=>clearInterval(e)},[h]),(0,s.useEffect)(()=>{let e=()=>{h()};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[h]),{unreadChats:e,unreadNotifications:a,activeOrders:o,isLoading:l,refresh:h}}},28069:(e,t,a)=>{"use strict";a.d(t,{Nq:()=>c,c4:()=>i,mH:()=>o,mg:()=>n,vx:()=>l});var s=a(51070),r=a(14140);let i=async()=>{let e=r.j.currentUser;return e?await e.getIdToken():null},n=async e=>s.Bb.post("/auth/login",{},{headers:{Authorization:"Bearer ".concat(e)}}),o=async(e,t,a,r)=>s.Bb.post("/auth/register",{role:e,phone:a,name:r},{headers:{Authorization:"Bearer ".concat(t)}}),c=async()=>s.xh.get("/auth/me"),l=async()=>s.xh.post("/auth/logout")},38464:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var s=a(31418),r=a(95155);let i=(0,s.A)((0,r.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack")},43452:(e,t,a)=>{"use strict";a.d(t,{MobileContainer:()=>o});var s=a(95155);a(12115);var r=a(54581),i=a(18407),n=a(35695);let o=e=>{let{children:t,width:a=375,height:o=812,showFrame:c=!0,backgroundColor:l,showBottomNav:d=!0}=e,h=(0,n.usePathname)(),u=(null==h?void 0:h.includes("/login"))||(null==h?void 0:h.includes("/register")),x=d&&!u;return c?(0,s.jsx)(r.default,{sx:{display:"flex",justifyContent:"center",alignItems:"center",padding:3,backgroundColor:"#f5f5f5"},children:(0,s.jsx)(i.A,{elevation:3,sx:{width:a,height:x?"calc(".concat(o,"px - 70px)"):o,borderRadius:6,overflow:"hidden",position:"relative",bgcolor:l||"background.default",border:"8px solid #000000","&::before":{content:'""',position:"absolute",top:12,left:"50%",transform:"translateX(-50%)",width:134,height:6,backgroundColor:"#000000",borderRadius:3,zIndex:1},"&::after":{content:'""',position:"absolute",bottom:8,left:"50%",transform:"translateX(-50%)",width:134,height:5,backgroundColor:"#000000",borderRadius:2.5,zIndex:1}},children:(0,s.jsx)(r.default,{"data-mobile-container":!0,sx:{width:"100%",height:"100%",paddingTop:"calc(24px + var(--safe-area-top))",overflow:"auto",position:"relative","&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none"},children:(0,s.jsx)(r.default,{sx:{paddingBottom:"calc(16px + var(--safe-area-bottom))",minHeight:"100%"},children:t})})})}):(0,s.jsx)(r.default,{"data-mobile-container":!0,sx:{width:"100vw",height:"100vh",bgcolor:l||"background.default",overflow:"hidden",position:"fixed",left:0,right:0,bottom:0,pt:"env(safe-area-inset-top)",pb:x?"68px":0,margin:0,"&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none"},children:(0,s.jsx)(r.default,{sx:{width:"100%",height:"100%",overflow:"auto",margin:0,padding:0,"&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none"},children:t})})}},51070:(e,t,a)=>{"use strict";a.d(t,{Bb:()=>o,H$:()=>i,xh:()=>n,y3:()=>c});var s=a(23464),r=a(14140);let i=a(6267).Ii.isNativePlatform()?"http://10.0.2.2:4242":"http://localhost:4242",n=s.A.create({baseURL:i,withCredentials:!0,timeout:3e4,headers:{"Content-Type":"application/json"}});n.interceptors.request.use(async e=>{let t=r.j.currentUser;if(t)try{let a=await t.getIdToken();e.headers.Authorization="Bearer ".concat(a)}catch(e){}return e},e=>Promise.reject(e)),n.interceptors.response.use(e=>e,e=>Promise.reject(e));let o=s.A.create({baseURL:i,withCredentials:!0,timeout:3e4,headers:{"Content-Type":"application/json"}});async function c(){try{return await s.A.get("".concat(i,"/api"),{timeout:5e3}),!0}catch(e){return!1}}o.interceptors.response.use(e=>e,e=>Promise.reject(e))},74588:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var s=a(31418),r=a(95155);let i=(0,s.A)((0,r.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel")},75680:(e,t,a)=>{Promise.resolve().then(a.bind(a,22845))},97704:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>p});var s=a(95155),r=a(12115),i=a(35695),n=a(18407),o=a(40541),c=a(9111),l=a(26564),d=a(11335),h=a(21888),u=a(43290),x=a(60807);let f=e=>e>99?"99+":e,p=(0,r.memo)(function(){let{className:e,unreadChatsCount:t=0,activeOrdersCount:a=0,unreadNotificationsCount:p=0,userRole:g}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=(0,i.useRouter)(),m=(0,i.usePathname)(),[v,y]=(0,r.useState)(()=>localStorage.getItem("userRole"));(0,r.useEffect)(()=>{if(!g){let e=null;m.startsWith("/available-deliveries")?e="picker":m.startsWith("/delivery-methods")&&(e="sender"),e&&e!==v&&(y(e),localStorage.setItem("userRole",e))}},[m,g,v]);let j=g||v,w=(0,r.useMemo)(()=>m.startsWith("/delivery-methods")||m.startsWith("/orders")||m.startsWith("/available-deliveries")?0:m.startsWith("/chat")?1:m.startsWith("/notifications")?2:3*!!m.startsWith("/profile"),[m]),[k,C]=(0,r.useState)(w),A=(0,r.useCallback)((e,t)=>{switch(C(t),t){case 0:"picker"===j?b.push("/available-deliveries"):b.push("/delivery-methods");break;case 1:b.push("/chats");break;case 2:b.push("/notifications");break;case 3:b.push("/profile")}},[b,j]);return(0,s.jsx)(n.A,{className:e,sx:{position:"fixed",bottom:0,left:0,right:0,width:"100vw",zIndex:1200,paddingBottom:"env(safe-area-inset-bottom)",paddingLeft:0,paddingRight:0,backgroundColor:"background.paper",borderTop:1,borderColor:"divider",borderRadius:0,boxShadow:"0px -2px 4px rgba(0, 0, 0, 0.1)"},elevation:0,children:(0,s.jsxs)(o.A,{value:k,onChange:A,sx:{backgroundColor:"background.paper",width:"100%",height:"68px",paddingLeft:"env(safe-area-inset-left)",paddingRight:"env(safe-area-inset-right)"},children:[(0,s.jsx)(c.A,{label:"Orders",icon:(0,s.jsx)(l.default,{badgeContent:f(a),color:"error",max:99,sx:{"& .MuiBadge-badge":{backgroundColor:"#FF9500",color:"#000000",fontWeight:600}},children:(0,s.jsx)(d.default,{})})}),(0,s.jsx)(c.A,{label:"Chat",icon:(0,s.jsx)(l.default,{badgeContent:f(t),color:"error",max:99,sx:{"& .MuiBadge-badge":{backgroundColor:"#FF9500",color:"#000000",fontWeight:600}},children:(0,s.jsx)(h.A,{})})}),(0,s.jsx)(c.A,{label:"Notifications",icon:(0,s.jsx)(l.default,{badgeContent:f(p),color:"error",max:99,sx:{"& .MuiBadge-badge":{backgroundColor:"#FF9500",color:"#000000",fontWeight:600}},children:(0,s.jsx)(u.A,{})})}),(0,s.jsx)(c.A,{label:"Profile",icon:(0,s.jsx)(x.default,{})})]})})})}},e=>{e.O(0,[3965,7225,9313,1623,3806,8534,5394,8441,5964,7358],()=>e(e.s=75680)),_N_E=e.O()}]);