(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[226],{6864:(e,t,a)=>{"use strict";a.d(t,{$H:()=>o,HW:()=>s,TK:()=>n,op:()=>l,wz:()=>r});var i=a(51070);let r=async e=>(await i.xh.get("/user/".concat(e))).data,n=async(e,t)=>(await i.xh.put("/user/".concat(e),t)).data,s=async()=>(await i.xh.get("/auth/me")).data,o=async(e,t)=>(await i.xh.put("/user/".concat(e,"/online-status"),{isOnline:t})).data,l=async e=>(await i.xh.get("/user/".concat(e,"/balance"))).data},15466:(e,t,a)=>{Promise.resolve().then(a.bind(a,77274))},21717:(e,t,a)=>{"use strict";a.d(t,{n:()=>r});var i=a(51070);let r={getUserNotifications:async()=>(await i.xh.get("/notifications")).data,getUnreadCount:async()=>(await i.xh.get("/notifications/unread-count")).data.count,markAsRead:async e=>(await i.xh.patch("/notifications/".concat(e,"/read"))).data,markAllAsRead:async()=>{await i.xh.patch("/notifications/mark-all-read")},notifyOfferReceived:async e=>(await i.xh.post("/notifications/offer-received",e)).data,notifyOfferAccepted:async e=>(await i.xh.post("/notifications/offer-accepted",e)).data,notifyIncomingDelivery:async e=>(await i.xh.post("/notifications/incoming-delivery",e)).data,notifyStatusUpdate:async e=>(await i.xh.post("/notifications/status-update",e)).data,createNotification:async e=>(await i.xh.post("/notifications/create",e)).data}},21787:(e,t,a)=>{"use strict";a.d(t,{IT:()=>l,S1:()=>h,TS:()=>p,XE:()=>c,confirmRecipient:()=>f,createDeliveryRequest:()=>s,fI:()=>n,qM:()=>u,rg:()=>m,updateDeliveryRequest:()=>d,vd:()=>r,zW:()=>o});var i=a(51070);let r=async()=>i.Bb.get("/delivery/pickers"),n=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"within-city";return i.Bb.get("/delivery/pickers/nearby?lat=".concat(e,"&lng=").concat(t,"&deliveryType=").concat(a))},s=async e=>i.xh.post("/delivery/requests",e),o=async()=>i.xh.get("/delivery/requests"),l=async e=>i.xh.get("/delivery/requests/".concat(e)),c=async(e,t)=>i.xh.put("/delivery/requests/".concat(e,"/status"),{status:t}),d=async(e,t)=>i.xh.patch("/delivery/requests/".concat(e),t),u=async()=>i.xh.get("/delivery/completed"),h=async()=>i.xh.get("/delivery/cancelled"),f=async(e,t)=>i.xh.put("/delivery/requests/".concat(e,"/confirm-recipient"),{confirmed:t}),m=async e=>i.xh.post("/delivery/find-receiver",{email:e}),p=async()=>i.xh.get("/delivery/incoming")},28307:(e,t,a)=>{"use strict";a.d(t,{H:()=>s});var i=a(95155),r=a(42663),n=a(35695);function s(e){let{name:t,avatarUrl:a,sx:s}=e,o=(0,n.useRouter)();return(0,i.jsx)(r.default,{src:a,sx:{width:40,height:40,cursor:"pointer","&:hover":{transform:"scale(1.05)",opacity:.8,boxShadow:"0 2px 8px rgba(0,0,0,0.15)"},...s},onClick:()=>o.push("/profile"),children:t[0]})}},50276:(e,t,a)=>{"use strict";a.d(t,{as:()=>i.ChatRoll,Ez:()=>n.LazyPickerFilters,Xg:()=>r.PickerCardMemo}),a(58343),a(97704);var i=a(74199);a(30478),a(21515);var r=a(54470);a(93183),a(98649),a(28331);var n=a(96701);a(81141),a(96033),a(19719)},77274:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>D});var i=a(95155),r=a(12115),n=a(54581),s=a(71803),o=a(3127),l=a(71116),c=a(92302),d=a(16950),u=a(97644),h=a(27088),f=a(17348),m=a(79892),p=a(77894),x=a(38464),y=a(95679),v=a(21984),g=a(94424),k=a(58343),w=a(50276),b=a(28307),j=a(97704),M=a(98226);let C=["Adam","Bartosz","Dawid","Filip","Grzegorz","Jakub","Jan","Kamil","Krzysztof","Łukasz","Maciej","Marcin","Mateusz","Michał","Paweł","Piotr","Przemysław","Rafał","Robert","Szymon","Tomasz","Wojciech","Zbigniew","Anna","Agnieszka","Aleksandra","Barbara","Beata","Ewa","Joanna","Justyna","Katarzyna","Magdalena","Małgorzata","Maria","Monika","Natalia","Sylwia"],S=["Nowak","Kowalski","Wiśniewski","W\xf3jcik","Kowalczyk","Kamiński","Lewandowski","Zieliński","Szymański","Woźniak","Dąbrowski","Kozłowski","Jankowski","Mazur","Kwiatkowski","Krawczyk","Piotrowski","Grabowski","Nowakowski","Pawłowski","Michalski","Nowicki","Adamczyk","Dudek","Zając","Wieczorek","Jabłoński","Kr\xf3l","Majewski","Olszewski","Jaworski","Malinowski"],z=["car","bike","scooter","walking"];function A(e){return e[Math.floor(Math.random()*e.length)]}function I(e,t){let a=[...e];return t.maxPrice&&(a=a.filter(e=>e.price<=t.maxPrice)),t.maxDuration&&(a=a.filter(e=>e.duration<=t.maxDuration)),t.minTrustLevel&&(a=a.filter(e=>e.trustLevel>=t.minTrustLevel)),t.sortBy&&a.sort((e,a)=>{let i,r;switch(t.sortBy){case"price":i=e.price,r=a.price;break;case"duration":i=e.duration,r=a.duration;break;case"trust":i=e.trustLevel,r=a.trustLevel;break;case"rating":i=e.rating,r=a.rating;break;case"distance":i=e.distance,r=a.distance;break;default:return 0}return"desc"===t.sortOrder?r-i:i-r}),a}Array.from({length:50},(e,t)=>(function(e){let t=A(C),a=A(S),i=Math.floor(100*Math.random())+1,r=Math.floor(20*Math.random())+10,n=Math.floor(45*Math.random())+15,s=Math.floor(500*Math.random())+10;return{id:"picker-".concat(e),fullName:"".concat(t," ").concat(a),email:"".concat(t.toLowerCase(),".").concat(a.toLowerCase(),"@example.com"),age:Math.floor(30*Math.random())+20,country:"Poland",city:"Warsaw",phoneNumber:"+48".concat(Math.floor(9e8*Math.random())+1e8),userType:M.u.PICKER,avatarUrl:void 0,description:A(["Experienced delivery professional","Quick and reliable service","Friendly neighborhood courier","Professional package handler","Fast and careful delivery","Trusted local delivery partner"]),rating:Math.round((2*Math.random()+3)*10)/10,trustLevel:i,price:r,duration:n,reviewCount:Math.floor(200*Math.random())+5,isOnline:Math.random()>.2,isVerified:i>60,isPhoneVerified:Math.random()>.3,isEmailVerified:Math.random()>.4,distance:Math.round((5*Math.random()+.5)*10)/10,vehicle:A(z),completedDeliveries:s,deliveryCount:s}})(t+1));var T=a(21787),P=a(21717),N=a(6864),E=a(35695);let L=(0,a(55028).default)(()=>Promise.all([a.e(9484),a.e(1761),a.e(5816)]).then(a.bind(a,15816)),{loadableGenerated:{webpack:()=>[15816]},ssr:!1,loading:()=>(console.log("PickersMap is loading..."),(0,i.jsx)(k.Ip,{type:"dots",text:"Loading map..."}))});function D(){let e=(0,E.useRouter)(),[t,a]=(0,r.useState)([]),[C,S]=(0,r.useState)([]),[z,A]=(0,r.useState)([]),[D,R]=(0,r.useState)(0),[W,K]=(0,r.useState)(!0),[O,_]=(0,r.useState)(""),[F,B]=(0,r.useState)(!0),[q,V]=(0,r.useState)(!1),[H,J]=(0,r.useState)(!1),[U,$]=(0,r.useState)(""),[X,G]=(0,r.useState)("list"),[Z,Y]=(0,r.useState)("within-city"),[Q,ee]=(0,r.useState)(null),[et,ea]=(0,r.useState)("price"),[ei,er]=(0,r.useState)("asc");(0,r.useEffect)(()=>{(async()=>{K(!0),_("");try{let e=localStorage.getItem("deliveryData"),t=null;if(e){let a=JSON.parse(e);a.fromLocation&&(t={lat:a.fromLocation.lat,lng:a.fromLocation.lng},ee(t))}let i=(t?await (0,T.fI)(t.lat,t.lng,Z):await (0,T.vd)()).data.map(e=>({id:e.uid,fullName:e.name,email:e.email,age:0,country:"",city:"",phoneNumber:e.phone||"",isVerified:!0,avatarUrl:e.avatarUrl||"",description:"",userType:M.u.PICKER,rating:Number(e.rating)||0,trustLevel:20*(Number(e.rating)||0),price:Number(e.price)||15,duration:e.estimatedTime||Math.floor(60*Math.random())+10,reviewCount:e.totalRatings||0,isOnline:e.isOnline||!1,isPhoneVerified:!!e.phone,isEmailVerified:!0,distance:e.distance||0,vehicle:"car",completedDeliveries:e.completedDeliveries||0,deliveryCount:e.completedDeliveries||0,location:e.location,estimatedTime:e.estimatedTime}));A(i),S(i);let r=i.slice(0,10);a(r),B(i.length>10)}catch(e){_("Failed to load pickers. Please try again.")}finally{K(!1)}})()},[Z]),(0,r.useEffect)(()=>{if(C.length>0){K(!0);let e=setTimeout(()=>{a(C.slice(0,10)),R(0),B(C.length>10),K(!1)},500);return()=>clearTimeout(e)}},[C]);let en=(0,r.useCallback)(e=>{S(I(z,{...e,sortBy:et,sortOrder:ei}))},[z,et,ei]),es=(0,r.useCallback)(e=>{let t=et===e&&"asc"===ei?"desc":"asc";ea(e),er(t),S(I(z,{sortBy:e,sortOrder:t}))},[et,ei,z]),eo=(0,r.useCallback)(()=>{if(!W&&F)return K(!0),setTimeout(()=>{let e=D+1,t=10*e,i=t+10,r=C.slice(t,i);r.length>0?(a(e=>[...e,...r]),R(e),B(i<C.length)):B(!1),K(!1)},600)},[D,C,W,F]);(0,r.useEffect)(()=>{let e=e=>{let t=e.target;t.scrollTop+t.clientHeight>=t.scrollHeight-100&&eo()},t=document.querySelector("[data-mobile-container]");if(t)return t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)},[eo]);let el=(0,r.useCallback)(e=>{localStorage.setItem("selectedPickerId",e),window.location.href="/chat/".concat(e)},[]),ec=(0,r.useCallback)(async t=>{let a=localStorage.getItem("deliveryData");if(!a){_("Delivery information not found. Please start from the beginning."),setTimeout(()=>e.push("/delivery-methods"),2e3);return}let i=JSON.parse(a),r=i.deliveryId;if(!r){_("Delivery ID not found. Please start from the beginning."),setTimeout(()=>e.push("/delivery-methods"),2e3);return}let n=z.find(e=>e.id===t);if(!n)return void _("Picker not found");J(!0),_("");try{let{user:a}=await (0,N.HW)();try{await P.n.createNotification({user_id:t,title:"New Delivery Invitation",message:"".concat(a.name," invited you to deliver a package from ").concat(i.fromAddress||"pickup location"," to ").concat(i.toAddress||"delivery location",". Check the delivery details and make an offer if interested."),type:"new_delivery",read:!1,related_delivery_id:r})}catch(e){throw e}$("Invitation sent to ".concat(n.fullName,"! They will be notified and can make an offer.")),localStorage.setItem("selectedPickerId",t),setTimeout(()=>{e.push("/delivery-methods?tab=manage")},2e3)}catch(e){var s,o;_((null==(o=e.response)||null==(s=o.data)?void 0:s.message)||"Failed to send invitation. Please try again.")}finally{J(!1)}},[z,e]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(k.kc,{showFrame:!1,children:[(0,i.jsx)(b.H,{name:"Vadim",sx:{position:"absolute",top:16,right:16,zIndex:10}}),(0,i.jsx)(n.default,{sx:{p:2,borderBottom:1,borderColor:"divider",backgroundColor:"background.paper",position:"sticky",top:0,zIndex:100},children:(0,i.jsxs)(s.A,{direction:"row",alignItems:"center",spacing:2,children:[(0,i.jsx)(o.A,{onClick:()=>window.history.back(),size:"small",sx:{p:1},children:(0,i.jsx)(x.A,{})}),(0,i.jsxs)(n.default,{sx:{flex:1},children:[(0,i.jsxs)(l.default,{variant:"h6",sx:{fontWeight:"bold"},children:["Available Pickers ","map"===X?"(Map View)":"(List View)"]}),(0,i.jsxs)(l.default,{variant:"caption",color:"text.secondary",children:["Found ",C.length," pickers in your area"]})]}),(0,i.jsx)(k.Lm,{variant:"icon",size:"small"})]})}),U&&(0,i.jsx)(n.default,{sx:{p:2},children:(0,i.jsx)(c.A,{severity:"success",children:U})}),O&&(0,i.jsx)(n.default,{sx:{p:2},children:(0,i.jsx)(c.A,{severity:"error",children:O})}),(0,i.jsx)(n.default,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:(0,i.jsxs)(s.A,{direction:"row",spacing:2,alignItems:"center",children:[(0,i.jsxs)(d.A,{value:X,exclusive:!0,onChange:(e,t)=>{console.log("View mode changing to:",t),t&&G(t)},size:"small",children:[(0,i.jsx)(u.A,{value:"list",children:(0,i.jsx)(y.A,{fontSize:"small"})}),(0,i.jsx)(u.A,{value:"map",children:(0,i.jsx)(v.A,{fontSize:"small"})})]}),(0,i.jsxs)(h.A,{size:"small",sx:{minWidth:120,flex:1},children:[(0,i.jsx)(f.A,{children:"Radius"}),(0,i.jsxs)(m.A,{value:Z,label:"Radius",onChange:e=>Y(e.target.value),children:[(0,i.jsx)(p.A,{value:"within-city",children:"City (10 km)"}),(0,i.jsx)(p.A,{value:"suburban",children:"Suburban (25 km)"}),(0,i.jsx)(p.A,{value:"inter-city",children:"Inter-city (50 km)"})]})]})]})}),(0,i.jsxs)(n.default,{sx:{borderBottom:1,borderColor:"divider"},children:[(0,i.jsx)(n.default,{sx:{p:2},children:(0,i.jsxs)(s.A,{direction:"row",spacing:1,sx:{flexWrap:"nowrap",overflowX:"auto"},children:[(0,i.jsxs)(k.$n,{onClick:()=>es("price"),variant:"price"===et?"contained":"outlined",size:"small",sx:{minWidth:"auto",whiteSpace:"nowrap"},children:["Price ","price"===et?"asc"===ei?"↑":"↓":""]}),(0,i.jsxs)(k.$n,{onClick:()=>es("duration"),variant:"duration"===et?"contained":"outlined",size:"small",sx:{minWidth:"auto",whiteSpace:"nowrap"},children:["Time ","duration"===et?"asc"===ei?"↑":"↓":""]}),(0,i.jsxs)(k.$n,{onClick:()=>es("trust"),variant:"trust"===et?"contained":"outlined",size:"small",sx:{minWidth:"auto",whiteSpace:"nowrap"},children:["Trust ","trust"===et?"asc"===ei?"↑":"↓":""]}),(0,i.jsx)(k.$n,{onClick:()=>V(!q),variant:q?"contained":"outlined",size:"small",startIcon:(0,i.jsx)(g.A,{}),sx:{minWidth:"auto",whiteSpace:"nowrap"},children:"Filters"})]})}),q&&(0,i.jsx)(n.default,{sx:{p:2,borderTop:1,borderColor:"divider"},children:(0,i.jsx)(w.Ez,{onFiltersChange:en})})]}),(0,i.jsx)(n.default,{sx:{flex:1,overflow:"auto"},children:W&&0===C.length?(0,i.jsx)(n.default,{sx:{py:8},children:(0,i.jsx)(k.Ip,{type:"dots",text:"Loading pickers..."})}):0===C.length?(0,i.jsxs)(n.default,{sx:{textAlign:"center",py:8},children:[(0,i.jsx)(l.default,{variant:"h1",sx:{fontSize:"4rem",mb:2},children:"\uD83D\uDCE6"}),(0,i.jsx)(l.default,{variant:"h6",sx:{mb:1,fontWeight:"bold"},children:"No pickers found"}),(0,i.jsx)(l.default,{variant:"body2",color:"text.secondary",children:Q?"No pickers available within this radius. Try increasing the search area.":"Try adjusting your search filters"})]}):"map"===X?(0,i.jsxs)(i.Fragment,{children:[console.log("Rendering map view. Pickers:",C.length,"FromLocation:",Q),(0,i.jsx)(n.default,{sx:{position:"relative",width:"100%",height:"calc(100vh - 300px)",minHeight:400},children:(0,i.jsx)(L,{pickers:C,fromLocation:Q,onSelectPicker:ec,onChatPicker:el,searchRadius:"within-city"===Z?10:"suburban"===Z?25:50})})]}):(0,i.jsxs)(n.default,{sx:{p:2},children:[(0,i.jsx)(s.A,{spacing:2,children:t.map(e=>(0,i.jsx)(w.Xg,{picker:e,onChat:el,onSelect:ec},e.id))}),W&&t.length>0&&(0,i.jsx)(n.default,{sx:{py:4},children:(0,i.jsx)(k.Ip,{type:"dots",text:"Loading more pickers..."})}),F&&!W&&(0,i.jsx)(n.default,{sx:{py:2,textAlign:"center"},children:(0,i.jsx)(k.$n,{variant:"outlined",onClick:eo,children:"Load More"})}),!F&&t.length>0&&(0,i.jsx)(n.default,{sx:{textAlign:"center",py:4},children:(0,i.jsxs)(l.default,{variant:"body2",color:"text.secondary",children:["All pickers loaded (",t.length," of ",C.length,")"]})})]})})]}),(0,i.jsx)(j.default,{})]})}},98226:(e,t,a)=>{"use strict";a.d(t,{u:()=>i,y:()=>r});var i=function(e){return e.SENDER="sender",e.PICKER="picker",e}({}),r=function(e){return e.WITHIN_CITY="within_city",e.INTER_CITY="inter_city",e.INTERNATIONAL="international",e.COMBINED="combined",e}({})}},e=>{e.O(0,[6084,3965,7225,3964,8202,6592,8534,7844,1101,5207,8652,8449,1190,7615,1986,2649,7212,1530,816,8142,3625,8343,4597,8441,5964,7358],()=>e(e.s=15466)),_N_E=e.O()}]);