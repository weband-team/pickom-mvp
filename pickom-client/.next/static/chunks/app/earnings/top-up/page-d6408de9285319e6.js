(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3614],{6864:(e,t,a)=>{"use strict";a.d(t,{$H:()=>n,HW:()=>i,TK:()=>s,op:()=>l,wz:()=>r});var o=a(51070);let r=async e=>(await o.x.get("/user/".concat(e))).data,s=async(e,t)=>(await o.x.put("/user/".concat(e),t)).data,i=async()=>(await o.x.get("/auth/me")).data,n=async(e,t)=>(await o.x.put("/user/".concat(e,"/online-status"),{isOnline:t})).data,l=async e=>(await o.x.get("/user/".concat(e,"/balance"))).data},14140:(e,t,a)=>{"use strict";a.d(t,{j:()=>i});var o=a(23915),r=a(45404);let s=(0,o.Wp)({apiKey:"AIzaSyDiclg8XNo2L1hDBoaSoHmFMBggUKYjHH4",authDomain:"pickom-mvp.firebaseapp.com",projectId:"pickom-mvp",storageBucket:"pickom-mvp.firebasestorage.app",messagingSenderId:"168767828055",appId:"1:168767828055:web:2853961b44970c114ab312"}),i=(0,r.xI)(s)},28069:(e,t,a)=>{"use strict";a.d(t,{Nq:()=>i,mH:()=>s,mg:()=>r,vx:()=>n});var o=a(51070);let r=async e=>o.B.post("/auth/login",{},{headers:{Authorization:"Bearer ".concat(e)}}),s=async(e,t,a,r)=>o.B.post("/auth/register",{role:e,phone:a,name:r},{headers:{Authorization:"Bearer ".concat(t)}}),i=async()=>o.x.get("/auth/me"),n=async()=>o.x.post("/auth/logout")},38464:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var o=a(31418),r=a(95155);let s=(0,o.A)((0,r.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack")},41923:(e,t,a)=>{Promise.resolve().then(a.bind(a,86033))},43452:(e,t,a)=>{"use strict";a.d(t,{MobileContainer:()=>n});var o=a(95155);a(12115);var r=a(54581),s=a(18407),i=a(35695);let n=e=>{let{children:t,width:a=375,height:n=812,showFrame:l=!0,backgroundColor:d,showBottomNav:c=!0}=e,u=(0,i.usePathname)(),h=(null==u?void 0:u.includes("/login"))||(null==u?void 0:u.includes("/register")),p=c&&!h;return l?(0,o.jsx)(r.default,{sx:{display:"flex",justifyContent:"center",alignItems:"center",padding:3,backgroundColor:"#f5f5f5"},children:(0,o.jsx)(s.A,{elevation:3,sx:{width:a,height:p?"calc(".concat(n,"px - 70px)"):n,borderRadius:6,overflow:"hidden",position:"relative",bgcolor:d||"background.default",border:"8px solid #000000","&::before":{content:'""',position:"absolute",top:12,left:"50%",transform:"translateX(-50%)",width:134,height:6,backgroundColor:"#000000",borderRadius:3,zIndex:1},"&::after":{content:'""',position:"absolute",bottom:8,left:"50%",transform:"translateX(-50%)",width:134,height:5,backgroundColor:"#000000",borderRadius:2.5,zIndex:1}},children:(0,o.jsx)(r.default,{"data-mobile-container":!0,sx:{width:"100%",height:"100%",paddingTop:6,overflow:"auto",position:"relative","&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none"},children:(0,o.jsx)(r.default,{sx:{paddingBottom:4,minHeight:"100%"},children:t})})})}):(0,o.jsx)(r.default,{"data-mobile-container":!0,sx:{width:"100%",maxWidth:a,height:p?"calc(100vh - 70px)":"100vh",maxHeight:p?"calc(".concat(n,"px - 70px)"):n,bgcolor:d||"background.default",overflow:"hidden",position:"relative","&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none"},children:(0,o.jsx)(r.default,{sx:{paddingBottom:0,minHeight:"100%",overflow:"auto",height:"100%"},children:t})})}},51070:(e,t,a)=>{"use strict";a.d(t,{B:()=>i,x:()=>s});var o=a(23464),r=a(14140);let s=o.A.create({baseURL:"".concat("http://localhost:4242"),withCredentials:!0,headers:{"Content-Type":"application/json"}});s.interceptors.request.use(async e=>{let t=r.j.currentUser;if(t){let a=await t.getIdToken();e.headers.Authorization="Bearer ".concat(a)}return e},e=>Promise.reject(e));let i=o.A.create({baseURL:"".concat("http://localhost:4242"),withCredentials:!0,headers:{"Content-Type":"application/json"}})},86033:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>y});var o=a(95155),r=a(54581),s=a(14426),i=a(92302),n=a(68534),l=a(71116),d=a(41218),c=a(16632),u=a(78449),h=a(38464),p=a(35695),x=a(12115),f=a(23464),m=a(31530),g=a(43452),b=a(97704),v=a(28069),j=a(6864);function y(){let e=(0,p.useRouter)(),[t,a]=(0,x.useState)(null),[y,k]=(0,x.useState)(0),[C,w]=(0,x.useState)("10"),[A,W]=(0,x.useState)("Balance top-up"),[B,S]=(0,x.useState)(!0),[I,H]=(0,x.useState)(!1),[F,M]=(0,x.useState)(""),[T,z]=(0,x.useState)("");(0,x.useEffect)(()=>{(async()=>{try{let e=(await (0,v.Nq)()).data.user;a(e);let t=await (0,j.op)(e.uid);k(t.balance||0)}catch(t){console.error("Failed to fetch user data:",t),M("Failed to load data. Please login again."),setTimeout(()=>e.push("/login"),2e3)}finally{S(!1)}})()},[e]);let R=e=>{let t=parseFloat(e);return isNaN(t)?(z("Please enter a valid number"),!1):t<1?(z("Minimum amount is $1"),!1):t>1e3?(z("Maximum amount is $1000"),!1):(z(""),!0)},N=async e=>{if(e.preventDefault(),t&&R(C)){H(!0);try{let{url:e}=(await f.A.post("".concat("http://localhost:4242","/payment/topup-balance"),{userId:t.uid,amount:parseFloat(C),description:A},{headers:{"Content-Type":"application/json"}})).data;console.log("Balance top-up session created"),m.default.success("Redirecting to payment page..."),window.location.href=e}catch(t){console.error("Balance top-up error:",t);let e="Unknown error occurred";if(t&&"object"==typeof t&&"response"in t){var a,o,r;e=(null==(o=t.response)||null==(a=o.data)?void 0:a.message)||"Server error: ".concat(null==(r=t.response)?void 0:r.status)}else t instanceof Error&&(e=t.message);m.default.error("Top-up failed: ".concat(e)),H(!1)}}};return B?(0,o.jsx)(r.default,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh"},children:(0,o.jsx)(s.default,{})}):F||!t?(0,o.jsx)(r.default,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",p:2},children:(0,o.jsx)(i.A,{severity:"error",children:F||"Failed to load data"})}):(0,o.jsx)(r.default,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f5f5f5",p:2},children:(0,o.jsxs)(r.default,{sx:{position:"relative",width:"100%",maxWidth:375,height:812},children:[(0,o.jsx)(g.MobileContainer,{showFrame:!1,children:(0,o.jsxs)(r.default,{sx:{p:3,pb:10,backgroundColor:"background.default",minHeight:"100vh"},children:[(0,o.jsxs)(r.default,{sx:{mb:3,display:"flex",alignItems:"center"},children:[(0,o.jsx)(n.A,{onClick:()=>{e.back()},sx:{minWidth:"auto",p:1,mr:1},children:(0,o.jsx)(h.A,{})}),(0,o.jsx)(l.default,{variant:"h5",sx:{fontWeight:600},children:"Top Up Balance"})]}),(0,o.jsx)(d.A,{sx:{mb:3},children:(0,o.jsxs)(c.A,{children:[(0,o.jsx)(l.default,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Current Balance"}),(0,o.jsxs)(l.default,{variant:"h4",sx:{fontWeight:700,color:"#667eea"},children:["$",y.toFixed(2)]})]})}),(0,o.jsxs)("form",{onSubmit:N,children:[(0,o.jsx)(r.default,{sx:{mb:3},children:(0,o.jsx)(u.default,{fullWidth:!0,label:"Amount (USD)",type:"number",value:C,onChange:e=>{let t=e.target.value;w(t),t&&R(t)},error:!!T,helperText:T||"Minimum: $1, Maximum: $1000",inputProps:{min:1,max:1e3,step:.01},required:!0})}),(0,o.jsx)(r.default,{sx:{mb:3},children:(0,o.jsx)(u.default,{fullWidth:!0,label:"Description (optional)",value:A,onChange:e=>W(e.target.value),multiline:!0,rows:2})}),(0,o.jsx)(i.A,{severity:"info",sx:{mb:3},children:"You will be redirected to Stripe Checkout to complete the payment securely."}),(0,o.jsx)(n.A,{fullWidth:!0,variant:"contained",type:"submit",disabled:I||!!T,sx:{py:1.5,fontSize:"1rem",fontWeight:600,textTransform:"none"},children:I?(0,o.jsx)(s.default,{size:24}):"Continue to Payment"})]})]})}),(0,o.jsx)(b.default,{})]})})}},97704:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>f});var o=a(95155),r=a(12115),s=a(35695),i=a(18407),n=a(40541),l=a(9111),d=a(26564),c=a(11335),u=a(21888),h=a(43290),p=a(60807);let x=e=>e>99?"99+":e,f=(0,r.memo)(function(){let{className:e,unreadChatsCount:t=0,activeOrdersCount:a=0,unreadNotificationsCount:f=0,userRole:m}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},g=(0,s.useRouter)(),b=(0,s.usePathname)(),[v,j]=(0,r.useState)(()=>localStorage.getItem("userRole"));(0,r.useEffect)(()=>{if(!m){let e=null;b.startsWith("/available-deliveries")?e="picker":b.startsWith("/delivery-methods")&&(e="sender"),e&&e!==v&&(j(e),localStorage.setItem("userRole",e))}},[b,m,v]);let y=m||v,k=(0,r.useMemo)(()=>b.startsWith("/delivery-methods")||b.startsWith("/orders")||b.startsWith("/available-deliveries")?0:b.startsWith("/chat")?1:b.startsWith("/notifications")?2:3*!!b.startsWith("/profile"),[b]),[C,w]=(0,r.useState)(k),A=(0,r.useCallback)((e,t)=>{switch(w(t),t){case 0:"picker"===y?g.push("/available-deliveries"):g.push("/delivery-methods");break;case 1:g.push("/chats");break;case 2:g.push("/notifications");break;case 3:g.push("/profile")}},[g,y]);return(0,o.jsx)(i.A,{className:e,sx:{position:"absolute",bottom:0,left:0,right:0,zIndex:1200,paddingBottom:"env(safe-area-inset-bottom)",backgroundColor:"background.paper",borderTop:1,borderColor:"divider",borderRadius:0,boxShadow:"none"},elevation:0,children:(0,o.jsxs)(n.A,{value:C,onChange:A,sx:{backgroundColor:"background.paper"},children:[(0,o.jsx)(l.A,{label:"Orders",icon:(0,o.jsx)(d.default,{badgeContent:x(a),color:"error",max:99,sx:{"& .MuiBadge-badge":{backgroundColor:"#FF9500",color:"#000000",fontWeight:600}},children:(0,o.jsx)(c.default,{})})}),(0,o.jsx)(l.A,{label:"Chat",icon:(0,o.jsx)(d.default,{badgeContent:x(t),color:"error",max:99,sx:{"& .MuiBadge-badge":{backgroundColor:"#FF9500",color:"#000000",fontWeight:600}},children:(0,o.jsx)(u.A,{})})}),(0,o.jsx)(l.A,{label:"Notifications",icon:(0,o.jsx)(d.default,{badgeContent:x(f),color:"error",max:99,sx:{"& .MuiBadge-badge":{backgroundColor:"#FF9500",color:"#000000",fontWeight:600}},children:(0,o.jsx)(h.A,{})})}),(0,o.jsx)(l.A,{label:"Profile",icon:(0,o.jsx)(p.default,{})})]})})})}},e=>{e.O(0,[3965,7225,8795,4611,8534,5207,8449,5394,1530,8441,5964,7358],()=>e(e.s=41923)),_N_E=e.O()}]);