(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6173,6509],{1074:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>k});var r=a(95155),i=a(16324),o=a(54581),n=a(3127),s=a(71116),c=a(41101),l=a(68534),d=a(14426),u=a(38464),f=a(43290),h=a(35695),x=a(43452),p=a(97704),y=a(71234),g=a(27604),m=a(33897),b=a(8093),v=a(12115),j=a(6864),w=a(21787);function k(){let e=(0,h.useRouter)();(0,i.A)();let{notifications:t,unreadCount:a,isLoading:k,error:C,markAsRead:S,markAllAsRead:A}=(0,y.E)(),{unreadChats:E,unreadNotifications:_,activeOrders:I}=(0,g.K)(),[W,R]=(0,v.useState)(null),[F,z]=(0,v.useState)("");(0,v.useEffect)(()=>{(async()=>{try{let e=await (0,j.HW)();z(e.user.role),R(e.user.uid)}catch(e){console.error("Failed to fetch current user:",e)}})()},[]);let N=async t=>{if(t.read||S(t.id),t.related_delivery_id)try{(await (0,w.IT)(t.related_delivery_id)).data.recipientId===W?e.push("/delivery-details/".concat(t.related_delivery_id)):"offer_received"===t.type?e.push("/delivery-methods/".concat(t.related_delivery_id,"/offers")):e.push("/delivery-details/".concat(t.related_delivery_id))}catch(a){console.error("Failed to fetch delivery:",a),e.push("/delivery-details/".concat(t.related_delivery_id))}};return(0,r.jsx)(o.default,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f5f5f5",p:2},children:(0,r.jsxs)(o.default,{sx:{position:"relative",width:"100%",maxWidth:375,height:812},children:[(0,r.jsx)(x.MobileContainer,{showFrame:!1,children:(0,r.jsxs)(o.default,{sx:{display:"flex",flexDirection:"column",height:"100vh",backgroundColor:"background.default"},children:[(0,r.jsxs)(o.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:2,borderBottom:1,borderColor:"divider"},children:[(0,r.jsxs)(o.default,{sx:{display:"flex",alignItems:"center"},children:[(0,r.jsx)(n.A,{onClick:()=>e.back(),sx:{mr:1,p:1},children:(0,r.jsx)(u.A,{})}),(0,r.jsxs)(s.default,{variant:"h5",sx:{fontWeight:600,fontSize:"1.5rem"},children:["Notifications",a>0&&(0,r.jsx)(c.A,{label:a,size:"small",color:"error",sx:{ml:1,height:20,fontSize:"0.75rem"}})]})]}),a>0&&(0,r.jsx)(l.A,{onClick:A,size:"small",sx:{textTransform:"none",fontSize:"0.875rem"},children:"Mark All Read"})]}),(0,r.jsx)(o.default,{sx:{flex:1,overflow:"auto",pb:8},children:k?(0,r.jsx)(o.default,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:8},children:(0,r.jsx)(d.default,{})}):C?(0,r.jsxs)(o.default,{sx:{p:3,textAlign:"center"},children:[(0,r.jsx)(s.default,{color:"error",variant:"body1",sx:{mb:1},children:"Loading Error"}),(0,r.jsx)(s.default,{variant:"body2",color:"text.secondary",children:C})]}):0===t.length?(0,r.jsxs)(o.default,{sx:{p:3,textAlign:"center",py:8},children:[(0,r.jsx)(f.A,{sx:{fontSize:64,color:"text.secondary",mb:2}}),(0,r.jsx)(s.default,{variant:"h6",sx:{mb:1,fontWeight:600},children:"No Notifications"}),(0,r.jsx)(s.default,{variant:"body2",color:"text.secondary",children:"Order notifications will appear here"})]}):(0,r.jsx)(o.default,{sx:{p:2},children:t.map(e=>(0,r.jsx)(o.default,{onClick:()=>N(e),sx:{p:2,mb:1.5,borderRadius:2,backgroundColor:e.read?"action.hover":"background.paper",border:1,borderColor:e.read?"divider":"primary.main",opacity:e.read?.7:1,cursor:"pointer",transition:"all 0.2s","&:hover":{boxShadow:2*!e.read}},children:(0,r.jsxs)(o.default,{sx:{display:"flex",gap:1.5},children:[(0,r.jsx)(s.default,{sx:{fontSize:"1.5rem"},children:(e=>{switch(e){case"offer_received":return"\uD83D\uDCBC";case"offer_accepted":case"recipient_confirmed":return"✅";case"status_update":return"\uD83D\uDCE6";case"incoming_delivery":return"\uD83D\uDCE5";case"new_delivery":return"\uD83D\uDE9A";case"recipient_rejected":return"❌";default:return"\uD83D\uDD14"}})(e.type)}),(0,r.jsxs)(o.default,{sx:{flex:1,minWidth:0},children:[(0,r.jsxs)(o.default,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[(0,r.jsx)(s.default,{variant:"subtitle2",sx:{fontWeight:e.read?500:600,color:e.read?"text.secondary":"text.primary"},children:e.title}),!e.read&&(0,r.jsx)(o.default,{sx:{width:8,height:8,bgcolor:"primary.main",borderRadius:"50%",flexShrink:0}})]}),(0,r.jsx)(s.default,{variant:"body2",sx:{mb:1,color:e.read?"text.secondary":"text.primary"},children:e.message}),(0,r.jsx)(s.default,{variant:"caption",color:"text.secondary",children:(0,m.m)(new Date(e.created_at),{addSuffix:!0,locale:b.c})})]})]})},e.id))})})]})}),(0,r.jsx)(p.default,{unreadChatsCount:E,unreadNotificationsCount:a,activeOrdersCount:I})]})})}},6864:(e,t,a)=>{"use strict";a.d(t,{$H:()=>s,HW:()=>n,TK:()=>o,op:()=>c,wz:()=>i});var r=a(51070);let i=async e=>(await r.x.get("/user/".concat(e))).data,o=async(e,t)=>(await r.x.put("/user/".concat(e),t)).data,n=async()=>(await r.x.get("/auth/me")).data,s=async(e,t)=>(await r.x.put("/user/".concat(e,"/online-status"),{isOnline:t})).data,c=async e=>(await r.x.get("/user/".concat(e,"/balance"))).data},14140:(e,t,a)=>{"use strict";a.d(t,{j:()=>n});var r=a(23915),i=a(45404);let o=(0,r.Wp)({apiKey:"AIzaSyDiclg8XNo2L1hDBoaSoHmFMBggUKYjHH4",authDomain:"pickom-mvp.firebaseapp.com",projectId:"pickom-mvp",storageBucket:"pickom-mvp.firebasestorage.app",messagingSenderId:"168767828055",appId:"1:168767828055:web:2853961b44970c114ab312"}),n=(0,i.xI)(o)},16509:(e,t,a)=>{"use strict";a.d(t,{TJ:()=>s,_z:()=>c,createChat:()=>i,iS:()=>l,m7:()=>n,ug:()=>o});var r=a(51070);let i=async e=>r.x.post("/chat/create",e),o=async()=>r.x.get("/chat"),n=async e=>r.x.get("/chat/delivery/".concat(e)),s=async e=>r.x.get("/chat/".concat(e)),c=async(e,t)=>r.x.post("/chat/".concat(e,"/messages"),t),l=async e=>r.x.patch("/chat/".concat(e,"/messages/mark-read"))},21717:(e,t,a)=>{"use strict";a.d(t,{n:()=>i});var r=a(51070);let i={getUserNotifications:async()=>(await r.x.get("/notifications")).data,getUnreadCount:async()=>(await r.x.get("/notifications/unread-count")).data.count,markAsRead:async e=>(await r.x.patch("/notifications/".concat(e,"/read"))).data,markAllAsRead:async()=>{await r.x.patch("/notifications/mark-all-read")},notifyOfferReceived:async e=>(await r.x.post("/notifications/offer-received",e)).data,notifyOfferAccepted:async e=>(await r.x.post("/notifications/offer-accepted",e)).data,notifyIncomingDelivery:async e=>(await r.x.post("/notifications/incoming-delivery",e)).data,notifyStatusUpdate:async e=>(await r.x.post("/notifications/status-update",e)).data,createNotification:async e=>(await r.x.post("/notifications/create",e)).data}},21787:(e,t,a)=>{"use strict";a.d(t,{IT:()=>s,S1:()=>u,TS:()=>x,XE:()=>c,confirmRecipient:()=>f,createDeliveryRequest:()=>o,qM:()=>d,rg:()=>h,updateDeliveryRequest:()=>l,vd:()=>i,zW:()=>n});var r=a(51070);let i=async()=>r.B.get("/delivery/pickers"),o=async e=>r.x.post("/delivery/requests",e),n=async()=>r.x.get("/delivery/requests"),s=async e=>r.x.get("/delivery/requests/".concat(e)),c=async(e,t)=>r.x.put("/delivery/requests/".concat(e,"/status"),{status:t}),l=async(e,t)=>r.x.patch("/delivery/requests/".concat(e),t),d=async()=>r.x.get("/delivery/completed"),u=async()=>r.x.get("/delivery/cancelled"),f=async(e,t)=>r.x.put("/delivery/requests/".concat(e,"/confirm-recipient"),{confirmed:t}),h=async e=>r.x.post("/delivery/find-receiver",{email:e}),x=async()=>r.x.get("/delivery/incoming")},27553:(e,t,a)=>{Promise.resolve().then(a.bind(a,1074))},27604:(e,t,a)=>{"use strict";a.d(t,{K:()=>n});var r=a(12115),i=a(21717),o=a(16509);function n(){let[e,t]=(0,r.useState)(0),[a,n]=(0,r.useState)(0),[s,c]=(0,r.useState)(0),[l,d]=(0,r.useState)(!0),u=(0,r.useCallback)(async()=>{try{let[e,a]=await Promise.all([(0,o.ug)().catch(()=>({data:[]})),i.n.getUnreadCount().catch(()=>0)]),r=e.data.reduce((e,t)=>e+(t.unreadCount||0),0);t(r),n(a),c(0)}catch(e){console.error("Failed to fetch navigation badge counts:",e)}finally{d(!1)}},[]);return(0,r.useEffect)(()=>{u()},[u]),(0,r.useEffect)(()=>{let e=setInterval(u,3e4);return()=>clearInterval(e)},[u]),(0,r.useEffect)(()=>{let e=()=>{u()};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[u]),{unreadChats:e,unreadNotifications:a,activeOrders:s,isLoading:l,refresh:u}}},43452:(e,t,a)=>{"use strict";a.d(t,{MobileContainer:()=>s});var r=a(95155);a(12115);var i=a(54581),o=a(18407),n=a(35695);let s=e=>{let{children:t,width:a=375,height:s=812,showFrame:c=!0,backgroundColor:l,showBottomNav:d=!0}=e,u=(0,n.usePathname)(),f=(null==u?void 0:u.includes("/login"))||(null==u?void 0:u.includes("/register")),h=d&&!f;return c?(0,r.jsx)(i.default,{sx:{display:"flex",justifyContent:"center",alignItems:"center",padding:3,backgroundColor:"#f5f5f5"},children:(0,r.jsx)(o.A,{elevation:3,sx:{width:a,height:h?"calc(".concat(s,"px - 70px)"):s,borderRadius:6,overflow:"hidden",position:"relative",bgcolor:l||"background.default",border:"8px solid #000000","&::before":{content:'""',position:"absolute",top:12,left:"50%",transform:"translateX(-50%)",width:134,height:6,backgroundColor:"#000000",borderRadius:3,zIndex:1},"&::after":{content:'""',position:"absolute",bottom:8,left:"50%",transform:"translateX(-50%)",width:134,height:5,backgroundColor:"#000000",borderRadius:2.5,zIndex:1}},children:(0,r.jsx)(i.default,{"data-mobile-container":!0,sx:{width:"100%",height:"100%",paddingTop:6,overflow:"auto",position:"relative","&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none"},children:(0,r.jsx)(i.default,{sx:{paddingBottom:4,minHeight:"100%"},children:t})})})}):(0,r.jsx)(i.default,{"data-mobile-container":!0,sx:{width:"100%",maxWidth:a,height:h?"calc(100vh - 70px)":"100vh",maxHeight:h?"calc(".concat(s,"px - 70px)"):s,bgcolor:l||"background.default",overflow:"hidden",position:"relative","&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none"},children:(0,r.jsx)(i.default,{sx:{paddingBottom:0,minHeight:"100%",overflow:"auto",height:"100%"},children:t})})}},51070:(e,t,a)=>{"use strict";a.d(t,{B:()=>n,x:()=>o});var r=a(23464),i=a(14140);let o=r.A.create({baseURL:"".concat("http://localhost:4242"),withCredentials:!0,headers:{"Content-Type":"application/json"}});o.interceptors.request.use(async e=>{let t=i.j.currentUser;if(t){let a=await t.getIdToken();e.headers.Authorization="Bearer ".concat(a)}return e},e=>Promise.reject(e));let n=r.A.create({baseURL:"".concat("http://localhost:4242"),withCredentials:!0,headers:{"Content-Type":"application/json"}})},71234:(e,t,a)=>{"use strict";a.d(t,{E:()=>n});var r=a(12115),i=a(21717),o=a(31530);let n=()=>{let[e,t]=(0,r.useState)([]),[a,n]=(0,r.useState)(0),[s,c]=(0,r.useState)(!0),[l,d]=(0,r.useState)(null),u=(0,r.useCallback)(async()=>{try{c(!0),d(null);let[e,a]=await Promise.all([i.n.getUserNotifications(),i.n.getUnreadCount()]);t(e),n(a)}catch(e){d(e instanceof Error?e.message:"Failed to load notifications"),console.error("Error fetching notifications:",e)}finally{c(!1)}},[]),f=(0,r.useCallback)(async e=>{try{await i.n.markAsRead(e),t(t=>t.map(t=>t.id===e?{...t,read:!0}:t)),n(e=>Math.max(0,e-1))}catch(t){let e=t instanceof Error?t.message:"Failed to mark notification as read";o.default.error(e),console.error("Error marking notification as read:",t)}},[]),h=(0,r.useCallback)(async()=>{try{await i.n.markAllAsRead(),t(e=>e.map(e=>({...e,read:!0}))),n(0),o.default.success("All notifications marked as read")}catch(t){let e=t instanceof Error?t.message:"Failed to mark all as read";o.default.error(e),console.error("Error marking all notifications as read:",t)}},[]),x=(0,r.useCallback)(async e=>{try{let a=await i.n.notifyOfferReceived(e);return t(e=>[a,...e]),n(e=>e+1),o.default.success("Offer notification created"),a}catch(t){let e=t instanceof Error?t.message:"Failed to create notification";throw o.default.error(e),console.error("Error creating offer received notification:",t),t}},[]),p=(0,r.useCallback)(async e=>{try{let a=await i.n.notifyOfferAccepted(e);return t(e=>[a,...e]),n(e=>e+1),o.default.success("Offer accepted notification created"),a}catch(t){let e=t instanceof Error?t.message:"Failed to create notification";throw o.default.error(e),console.error("Error creating offer accepted notification:",t),t}},[]),y=(0,r.useCallback)(async e=>{try{let a=await i.n.notifyIncomingDelivery(e);return t(e=>[a,...e]),n(e=>e+1),o.default.success("Incoming delivery notification created"),a}catch(t){let e=t instanceof Error?t.message:"Failed to create notification";throw o.default.error(e),console.error("Error creating incoming delivery notification:",t),t}},[]),g=(0,r.useCallback)(async e=>{try{let a=await i.n.notifyStatusUpdate(e);return t(e=>[a,...e]),n(e=>e+1),o.default.success("Status update notification created"),a}catch(t){let e=t instanceof Error?t.message:"Failed to create notification";throw o.default.error(e),console.error("Error creating status update notification:",t),t}},[]),m=(0,r.useCallback)(async e=>{try{let a=await i.n.createNotification(e);return t(e=>[a,...e]),n(e=>e+1),o.default.success("Notification created"),a}catch(t){let e=t instanceof Error?t.message:"Failed to create notification";throw o.default.error(e),console.error("Error creating custom notification:",t),t}},[]),b=e.filter(e=>!e.read);return(0,r.useEffect)(()=>{u()},[u]),{notifications:e,unreadNotifications:b,unreadCount:a,isLoading:s,error:l,fetchNotifications:u,markAsRead:f,markAllAsRead:h,createOfferReceivedNotification:x,createOfferAcceptedNotification:p,createIncomingDeliveryNotification:y,createStatusUpdateNotification:g,createCustomNotification:m}}},97704:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>p});var r=a(95155),i=a(12115),o=a(35695),n=a(18407),s=a(40541),c=a(9111),l=a(26564),d=a(11335),u=a(21888),f=a(43290),h=a(60807);let x=e=>e>99?"99+":e,p=(0,i.memo)(function(){let{className:e,unreadChatsCount:t=0,activeOrdersCount:a=0,unreadNotificationsCount:p=0,userRole:y}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},g=(0,o.useRouter)(),m=(0,o.usePathname)(),[b,v]=(0,i.useState)(()=>localStorage.getItem("userRole"));(0,i.useEffect)(()=>{if(!y){let e=null;m.startsWith("/available-deliveries")?e="picker":m.startsWith("/delivery-methods")&&(e="sender"),e&&e!==b&&(v(e),localStorage.setItem("userRole",e))}},[m,y,b]);let j=y||b,w=(0,i.useMemo)(()=>m.startsWith("/delivery-methods")||m.startsWith("/orders")||m.startsWith("/available-deliveries")?0:m.startsWith("/chat")?1:m.startsWith("/notifications")?2:3*!!m.startsWith("/profile"),[m]),[k,C]=(0,i.useState)(w),S=(0,i.useCallback)((e,t)=>{switch(C(t),t){case 0:"picker"===j?g.push("/available-deliveries"):g.push("/delivery-methods");break;case 1:g.push("/chats");break;case 2:g.push("/notifications");break;case 3:g.push("/profile")}},[g,j]);return(0,r.jsx)(n.A,{className:e,sx:{position:"absolute",bottom:0,left:0,right:0,zIndex:1200,paddingBottom:"env(safe-area-inset-bottom)",backgroundColor:"background.paper",borderTop:1,borderColor:"divider",borderRadius:0,boxShadow:"none"},elevation:0,children:(0,r.jsxs)(s.A,{value:k,onChange:S,sx:{backgroundColor:"background.paper"},children:[(0,r.jsx)(c.A,{label:"Orders",icon:(0,r.jsx)(l.default,{badgeContent:x(a),color:"error",max:99,sx:{"& .MuiBadge-badge":{backgroundColor:"#FF9500",color:"#000000",fontWeight:600}},children:(0,r.jsx)(d.default,{})})}),(0,r.jsx)(c.A,{label:"Chat",icon:(0,r.jsx)(l.default,{badgeContent:x(t),color:"error",max:99,sx:{"& .MuiBadge-badge":{backgroundColor:"#FF9500",color:"#000000",fontWeight:600}},children:(0,r.jsx)(u.A,{})})}),(0,r.jsx)(c.A,{label:"Notifications",icon:(0,r.jsx)(l.default,{badgeContent:x(p),color:"error",max:99,sx:{"& .MuiBadge-badge":{backgroundColor:"#FF9500",color:"#000000",fontWeight:600}},children:(0,r.jsx)(f.A,{})})}),(0,r.jsx)(c.A,{label:"Profile",icon:(0,r.jsx)(h.default,{})})]})})})}},e=>{e.O(0,[3965,7225,8795,4611,8534,1101,2649,1530,8378,8441,5964,7358],()=>e(e.s=27553)),_N_E=e.O()}]);